<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>平衡感调节小游戏</title>
    <!-- 引入 Tailwind CSS，用于快速构建响应式界面 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Inter 字体，提升可读性 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@404&display=swap" rel="stylesheet">
    <style>
        /* 基础样式，针对中老年用户增加字体大小和粗细 */
        body {
            font-family: 'Inter', sans-serif;
            font-size: 2.8rem;
            font-weight: 400;
            line-height: 1.6;
            background-color: #ffe4ef; /* a little pink background */
            color: #60a5fa; /* LIGHT BLUE 字体 */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* 标题字体加粗 */
        h1, h2, h3 {
            font-weight: 500;
            font-size: 6.4rem;
            color: #60a5fa; /* LIGHT BLUE 标题 */
        }
        /* 页面内容容器 */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #ffe4ef; /* a little pink background for container */
        }
        /* 模态框基础样式 */
        .modal {
            display: none; /* 默认隐藏 */
            position: fixed; /* 固定定位 */
            z-index: 1000; /* 叠放顺序在最上层 */
            left: 0;
            top: 0;
            width: 100%; /* 全宽 */
            height: 100%; /* 全高 */
            overflow: auto; /* 允许滚动 */
            background-color: rgba(0,0,0,0.6); /* 半透明黑色背景 */
            justify-content: center; /* 水平居中 */
            align-items: center; /* 垂直居中 */
        }
        /* 模态框内容样式 */
        .modal-content {
            background-color: #ffe4ef; /* a little pink background for modal */
            margin: auto;
            padding: 1.5rem;
            border-radius: 3rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-width: 90%;
            width: 1200px;
            text-align: center;
            position: relative;
            color: #60a5fa;
            font-size: 1.5rem;
        }
        /* 页面切换容器样式 */
        .page {
            display: none; /* 默认隐藏 */
        }
        /* 头部样式 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: #ffe4ef; /* a little pink background for header */
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        /* 按钮样式 */
        .btn {
            background-color: #f59e42;
            color: #60a5fa;
            padding: 1.5rem 3rem;
            border-radius: 1.5rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-size: 4rem;
        }
        .btn:hover {
            background-color: #ea580c;
        }
        .btn:active {
            transform: translateY(1px);
            background-color: #c2410c;
        }
        /* 输入框和下拉框样式 */
        input, select {
            padding: 1.5rem;
            border: 1px solid #ccc;
            border-radius: 1rem;
            width: 100%;
            max-width: 600px;
            font-size: 4rem;
            margin-bottom: 2rem;
            box-sizing: border-box;
            color: #60a5fa;
        }
        label {
            display: block;
            margin-bottom: 1rem;
            font-weight: bold;
            text-align: left;
            font-size: 4rem;
            color: #60a5fa;
        }
        /* 视频容器布局 */
        .video-container {
            display: grid;
            grid-template-columns: 2fr 1fr; /* 标准动作视频区域更大，用户视频区域较小 */
            gap: 2rem;
            margin-top: 3rem;
            background-color: #ffe4ef; /* a little pink background for video container */
            padding: 2rem;
            border-radius: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            color: #60a5fa;
            font-size: 4rem;
        }
        /* 视频包裹器，用于保持视频宽高比 */
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 75%; /* 4:3 宽高比 (高度 / 宽度 * 100) */
            background-color: #ffe4ef; /* a little pink background for video wrapper */
            border-radius: 1.5rem;
            overflow: hidden; /* 隐藏超出部分 */
        }
        /* 视频和 Canvas 覆盖样式 */
        .video-wrapper video, .video-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* 确保视频内容适配容器 */
        }
        /* 倒计时文本样式 */
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24rem;
            color: #60a5fa;
            z-index: 10;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            font-weight: bold;
        }
        /* 移动端响应式调整 */
        @media (max-width: 768px) {
            body {
                font-size: 3rem;
            }
            h1, h2, h3 {
                font-size: 4rem;
            }
            .btn, input, select, label {
                font-size: 3rem;
            }
            .countdown {
                font-size: 12rem;
            }
        }
        
        /* Apple 风格 Tab 导航样式 */
        .tab-navigation {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 2rem;
            padding: 1rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .tab-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: transparent;
            border: none;
            padding: 1.5rem 3rem;
            font-size: 3rem;
            font-weight: 500;
            color: #60a5fa;
            cursor: pointer;
            border-radius: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-btn:hover {
            background-color: rgba(96, 165, 250, 0.1);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background-color: #60a5fa;
            color: white;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }
        
        /* Tab 内容区域样式 */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 位置输入区域样式 */
        .location-input {
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .location-input input {
            margin-bottom: 0;
        }
        
        /* 推荐卡片样式 */
        .recommendation-card {
            background: linear-gradient(135deg, #ffe4ef 0%, #f0f9ff 100%);
            border-radius: 2rem;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid transparent;
        }
        
        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: #60a5fa;
        }
        
        .recommendation-card h4 {
            color: #60a5fa;
            font-size: 3rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .recommendation-card p {
            color: #6b7280;
            font-size: 2.2rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }
        
        .recommendation-card .rating {
            color: #f59e42;
            font-weight: bold;
            font-size: 2.4rem;
        }
        
        .recommendation-card .address {
            color: #9ca3af;
            font-size: 2rem;
            font-style: italic;
        }
        
        /* 保健品分类按钮样式 */
        .category-btn {
            background-color: #f3f4f6;
            color: #60a5fa;
            padding: 1.2rem 2.4rem;
            border-radius: 1.2rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            font-size: 2.4rem;
        }
        
        .category-btn:hover {
            background-color: #e5e7eb;
            transform: translateY(-2px);
        }
        
        .category-btn.active {
            background-color: #60a5fa;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .tab-container {
                gap: 1rem;
            }
            
            .tab-btn {
                font-size: 2.4rem;
                padding: 1.2rem 2rem;
            }
            
            .location-input {
                flex-direction: column;
                align-items: center;
            }
            
            .recommendation-card h4 {
                font-size: 2.4rem;
            }
            
            .recommendation-card p {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>

    <!-- 网页头部区域 -->
    <div class="header">
        <h1 class="text-2xl font-bold text-indigo-700" id="appTitle">平衡感调节小游戏</h1>
        <div class="language-selector">
            <label for="languageSelect" class="sr-only">选择语言</label>
            <select id="languageSelect" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="zh-CN">简体中文</option>
                <option value="zh-TW">繁體中文</option>
                <option value="en">English</option>
            </select>
        </div>
    </div>

    <!-- 用户信息输入页面 (点击免责声明确认后显示) -->
    <div id="userInfoPage" class="page container py-8">
        <h2 class="text-3xl font-bold mb-8 text-center text-indigo-700" id="userInfoTitle">请输入您的信息</h2>
        <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg">
            <div class="mb-4">
                <label for="ageInput" id="labelAge">年龄：</label>
                <input type="number" id="ageInput" placeholder="请输入您的年龄" class="w-full">
            </div>
            <div class="mb-4">
                <label for="genderSelect" id="labelGender">性别：</label>
                <select id="genderSelect" class="w-full">
                    <option value="" disabled selected id="genderPlaceholder">请选择性别</option>
                    <option value="male" id="genderMale">男</option>
                    <option value="female" id="genderFemale">女</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="weightInput" id="labelWeight">体重 (kg):</label>
                <input type="number" id="weightInput" placeholder="请输入您的体重 (kg)" step="0.1" class="w-full">
            </div>
            <div class="mb-6">
                <label for="heightInput" id="labelHeight">身高 (m):</label>
                <input type="number" id="heightInput" placeholder="请输入您的身高 (m)" step="0.01" class="w-full">
            </div>
            <button id="submitUserInfoBtn" class="btn w-full text-xl">提交</button>
        </div>
    </div>

    <!-- 游戏主页面 (输入用户信息后显示) -->
    <div id="gamePage" class="page container py-8">
        <h2 class="text-3xl font-bold mb-6 text-center text-indigo-700" id="gamePageTitle">平衡感调节游戏</h2>

        <!-- 添加 Apple 风格的 Tab 导航 -->
        <div class="tab-navigation">
            <div class="tab-container">
                <button class="tab-btn active" data-tab="game" id="gameTab">游戏</button>
                <button class="tab-btn" data-tab="restaurant" id="restaurantTab">餐厅推荐</button>
                <button class="tab-btn" data-tab="gym" id="gymTab">健身房推荐</button>
                <button class="tab-btn" data-tab="supplement" id="supplementTab">保健品推荐</button>
            </div>
        </div>

        <!-- 游戏内容区域 -->
        <div id="gameContent" class="tab-content active">
            <div class="flex flex-col md:flex-row justify-center items-center md:items-start gap-6 mb-6 bg-white p-6 rounded-xl shadow-lg">
                <div class="w-full md:w-1/3">
                    <label for="difficultySelect" class="block mb-2 font-bold" id="labelDifficulty">选择游戏难度：</label>
                    <select id="difficultySelect" class="p-3 border rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="high" id="difficultyHigh">高</option>
                        <option value="mid" id="difficultyMid">中</option>
                        <option value="easy" id="difficultyEasy">低</option>
                    </select>
                </div>
                <div class="w-full md:w-2/3 text-center md:text-right">
                    <p class="text-2xl font-bold mb-2" id="currentScoreLabel">当前平均得分：</p>
                    <p id="averageScoreDisplay" class="text-4xl font-extrabold text-green-600">0</p>
                </div>
            </div>

            <div class="video-container">
                <!-- 标准动作视频区域 -->
                <div class="video-wrapper relative">
                    <h3 class="absolute top-2 left-2 z-10 text-white text-lg font-bold bg-black bg-opacity-50 px-2 py-1 rounded" id="standardVideoLabel">标准动作</h3>
                    <video id="standardVideo" autoplay loop muted playsinline></video>
                    <canvas id="standardCanvas" class="absolute top-0 left-0"></canvas>
                </div>
                <!-- 用户实时视频及姿态分析区域 -->
                <div class="video-wrapper relative">
                    <h3 class="absolute top-2 left-2 z-10 text-white text-lg font-bold bg-black bg-opacity-50 px-2 py-1 rounded" id="userVideoLabel">您的实时动作</h3>
                    <video id="userVideo" autoplay playsinline></video>
                    <canvas id="userCanvas" class="absolute top-0 left-0"></canvas>
                    <div id="countdownDisplay" class="countdown hidden">3</div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button id="startGameBtn" class="btn text-2xl px-8 py-4">开始游戏</button>
            </div>
        </div>

        <!-- 餐厅推荐内容区域 -->
        <div id="restaurantContent" class="tab-content">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold mb-6 text-center" id="restaurantTitle">健康餐厅推荐</h3>
                <div class="location-input mb-6">
                    <div class="text-center">
                        <button id="getLocationBtn" class="btn">获取我的位置并推荐餐厅</button>
                        <p id="locationStatus" class="mt-4 text-gray-600"></p>
                    </div>
                </div>
                <div id="restaurantList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 餐厅推荐将在这里显示 -->
                </div>
            </div>
        </div>

        <!-- 健身房推荐内容区域 -->
        <div id="gymContent" class="tab-content">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold mb-6 text-center" id="gymTitle">适老健身房推荐</h3>
                <div class="location-input mb-6">
                    <div class="text-center">
                        <button id="getGymBtn" class="btn">获取我的位置并推荐健身房</button>
                        <p id="gymLocationStatus" class="mt-4 text-gray-600"></p>
                    </div>
                </div>
                <div id="gymList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 健身房推荐将在这里显示 -->
                </div>
            </div>
        </div>

        <!-- 保健品推荐内容区域 -->
        <div id="supplementContent" class="tab-content">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold mb-6 text-center" id="supplementTitle">保健品推荐</h3>
                <div class="supplement-categories mb-6">
                    <div class="flex flex-wrap gap-4 justify-center">
                        <button class="category-btn active" data-category="cardiovascular" id="cardiovascularBtn">心血管健康</button>
                        <button class="category-btn" data-category="protein" id="proteinBtn">蛋白质补充</button>
                        <button class="category-btn" data-category="joint" id="jointBtn">关节健康</button>
                        <button class="category-btn" data-category="immunity" id="immunityBtn">免疫力提升</button>
                    </div>
                </div>
                <div id="supplementList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 保健品推荐将在这里显示 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 游戏结束模态框 -->
    <div id="gameOverModal" class="modal flex">
        <div class="modal-content">
            <h2 class="text-3xl font-extrabold mb-6 text-indigo-700" id="gameOverTitle">游戏结束！</h2>
            <p class="text-2xl mb-4" id="finalScoreText">您的最终得分：</p>
            <p id="finalScoreDisplay" class="text-5xl font-extrabold text-purple-600 mb-6">0</p>
            <h3 class="text-xl font-bold mb-3" id="adviceTitle">营养补充建议：</h3>
            <p id="nutritionAdvice" class="mb-6 leading-relaxed">根据您的表现，建议...</p>
            <button id="restartGameBtn" class="btn text-xl">重新开始</button>
        </div>
    </div>

    <!-- 免责声明模态框 (默认显示) -->
    <div id="disclaimerModal" class="modal flex">
        <div class="modal-content">
            <h2 class="text-3xl font-extrabold mb-6 text-red-600" id="disclaimerTitle">免责声明</h2>
            <p class="mb-6 leading-relaxed" id="disclaimerText">
                本网站的内容不构成专业的医疗建议，请根据自己的身体状况选择适当的活动。
                本网站提出的建议仅作为参考并且不构成任何医疗建议。
                如果感到身体不适，请及时就医。
                本网站不会收集您的个人数据也不会保存任何视频。
                您在本网站中输入的任何信息都只是为了推荐更加适合您的小游戏而使用，它们不会被上传到我们的服务器。
            </p>
            <button id="confirmDisclaimerBtn" class="btn text-xl">我已阅读并同意</button>
        </div>
    </div>

    <script type="module">
        // 导入 MediaPipe PoseLandmarker、FilesetResolver 和 DrawingUtils 模块
        import { PoseLandmarker, FilesetResolver, DrawingUtils } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0";

        // 多语言翻译字典
        const translations = {
            'zh-TW': {
                appTitle: '老年健康助手',
                welcomeMessage: '歡迎使用老年健康助手！',
                recommendationTitle: '健康推薦',
                mealPlanTitle: '飲食計劃',
                gameTitle: '益智遊戲',
                languageToggle: '語言切換',
                gameInstructions: '點擊下方按鈕開始遊戲：',
                startGame: '開始遊戲',
                stopGame: '停止遊戲',
                gameScore: '得分',
                gameTime: '時間',
                brandLabel: '品牌：',
                ratingLabel: '評分：',
                priceLabel: '價格：',
                effectLabel: '功效：',
                disclaimerTitle: '免責聲明',
                disclaimerText: '本網站的内容不構成專業的醫療建議，請根據自己的身體狀況選擇適當的活動。本網站提出的建議僅作為參考並且不構成任何醫療建議。如果感到身體不適，請及時就醫。本網站不會收集您的個人數據也不會保存任何視頻。您在本網站中輸入的任何信息都只是為了推薦更加適合您的小遊戲而使用，它們不會被上傳到我們的服務器。',
                confirmDisclaimerBtn: '我已閱讀並同意',
                userInfoTitle: '請輸入您的信息',
                labelAge: '年齡：',
                ageInputPlaceholder: '請輸入您的年齡',
                labelGender: '性別：',
                genderPlaceholder: '請選擇性別',
                genderMale: '男',
                genderFemale: '女',
                labelWeight: '體重 (kg):',
                weightInputPlaceholder: '請輸入您的體重 (kg)',
                labelHeight: '身高 (m):',
                heightInputPlaceholder: '請輸入您的身高 (m)',
                submitUserInfoBtn: '提交',
                gamePageTitle: '平衡感調節遊戲',
                // Tab 标签
                gameTab: '遊戲',
                restaurantTab: '餐廳推薦',
                gymTab: '健身房推薦',
                supplementTab: '保健品推薦',
                // 游戏相关
                labelDifficulty: '選擇遊戲難度：',
                difficultyHigh: '高',
                difficultyMid: '中',
                difficultyEasy: '低',
                currentScoreLabel: '當前平均得分：',
                standardVideoLabel: '標準動作',
                userVideoLabel: '您的實時動作',
                startGameBtn: '開始遊戲',
                endGameBtn: '結束遊戲',
                // 餐厅推荐
                restaurantTitle: '健康餐廳推薦',
                getLocationBtn: '獲取我的位置並推薦餐廳',
                locationStatus: '正在獲取您的位置...',
                locationSuccess: '位置獲取成功！為您推薦附近的餐廳：',
                locationError: '無法獲取位置資訊',
                locationDenied: '位置權限被拒絕',
                locationUnavailable: '位置資訊不可用',
                locationTimeout: '位置獲取超時',
                noRecommendations: '顯示一般推薦',
                // 健身房推荐
                gymTitle: '適老健身房推薦',
                getGymBtn: '獲取我的位置並推薦健身房',
                gymLocationStatus: '正在獲取您的位置...',
                gymLocationSuccess: '位置獲取成功！為您推薦附近的健身房：',
                gymLocationError: '無法獲取位置資訊',
                gymLocationDenied: '位置權限被拒絕',
                gymLocationUnavailable: '位置資訊不可用',
                gymLocationTimeout: '位置獲取超時',
                noGymRecommendations: '顯示一般推薦',
                // 保健品推荐
                supplementTitle: '保健品推薦',
                cardiovascularBtn: '心血管健康',
                proteinBtn: '蛋白質補充',
                jointBtn: '關節健康',
                immunityBtn: '免疫力提升',
                // 推荐卡片标签
                typeLabel: '類型：',
                ratingLabel: '評分：',
                addressLabel: '地址：',
                reasonLabel: '推薦理由：',
                featureLabel: '特色：',
                brandLabel: '品牌：',
                priceLabel: '價格：',
                effectLabel: '功效：',
                // 输入提示和错误消息
                enterLocationPrompt: '請輸入您的位置',
                noRestaurantRecommendations: '暫無該地區的餐廳推薦，請嘗試其他城市如：香港、台北、上海',
                noGymRecommendationsArea: '暫無該地區的健身房推薦，請嘗試其他城市如：香港、台北、上海',
                // 游戏结束
                gameOverTitle: '遊戲結束！',
                finalScoreText: '您的最終得分：',
                adviceTitle: '營養補充建議：',
                nutritionAdviceLow: '您的表現還有提升空間。建議多補充蛋白質和鈣質，例如牛奶、豆腐、魚肉，以增強肌肉和骨骼健康。同時，可以嘗試低強度的平衡練習。',
                nutritionAdviceLowSupplements: [
                    '維特健靈 - 活關素特強特效膠囊（90 粒）',
                    'Move Free 益節 氨糖軟骨素',
                    'Swisse 關節健康片',
                    'Blackmores 關節靈',
                    '健力多 氨糖軟骨素鈣片',
                    'Kirkland Glucosamine HCl with MSM',
                    'Nature Made TripleFlex',
                    'Schiff Glucosamine Plus MSM',
                    'Puritan\'s Pride Glucosamine Chondroitin MSM',
                    '健安喜 (GNC) 關節健康配方'
                ],
                nutritionAdviceMid: '您的關節需要更多呵護，建議補充關節靈活相關保健品，並適度運動。',
                nutritionAdviceMidSupplements: [
                    '川御一 關節の御守',
                    'Sato 佐藤製藥 關節守護',
                    'ORIHIRO 葡萄糖胺',
                    '日本小林製藥 關節靈',
                    '善存 關節健康配方',
                    '森下仁丹 關節靈',
                    'DHC 關節靈活片',
                    '永信 關節寶',
                    '台塑生醫 關健素',
                    '白蘭氏 關鍵活力膠囊'
                ],
                nutritionAdviceHigh: '您的表現非常出色！請繼續保持良好的運動習慣和均衡的飲食。',
                nutritionAdviceHighSupplements: [
                    '醫之選 - 液關健',
                    '安美露 關節舒緩液',
                    '葡萄王 關健寶',
                    '康健生技 關健飲',
                    '台塑生醫 關健飲',
                    '善存 關鍵活力飲',
                    '白蘭氏 關鍵飲',
                    'Swisse 關節健康飲',
                    'Move Free 關節飲',
                    'GNC 關節健康飲'
                ],
                restartGameBtn: '重新开始',
                cameraAccessError: '无法访问摄像头，请检查权限设置。',
                invalidInputError: '请填写有效的年龄、体重和身高！',
                enterLocationPrompt: '请输入您的位置',
                noRestaurantRecommendations: '暂无该地区的餐厅推荐，请尝试其他城市如：香港、台北、上海',
                noGymRecommendationsArea: '暂无该地区的健身房推荐，请尝试其他城市如：香港、台北、上海'
            },
            'zh-CN': {
                appTitle: '老年健康助手',
                welcomeMessage: '欢迎使用老年健康助手！',
                recommendationTitle: '健康推荐',
                mealPlanTitle: '饮食计划',
                gameTitle: '益智游戏',
                languageToggle: '语言切换',
                gameInstructions: '点击下方按钮开始游戏：',
                startGame: '开始游戏',
                stopGame: '停止游戏',
                gameScore: '得分',
                gameTime: '时间',
                brandLabel: '品牌：',
                ratingLabel: '评分：',
                priceLabel: '价格：',
                effectLabel: '功效：',
                disclaimerTitle: '免责声明',
                disclaimerText: '本网站的内容不构成专业的医疗建议，请根据自己的身体状况选择适当的活动。本网站提出的建议仅作为参考并且不构成任何医疗建议。如果感到身体不适，请及时就医。本网站不会收集您的个人数据也不会保存任何视频。您在本网站中输入的任何信息都只是为了推荐更加适合您的小游戏而使用，它们不会被上传到我们的服务器。',
                confirmDisclaimerBtn: '我已阅读并同意',
                userInfoTitle: '请输入您的信息',
                labelAge: '年龄：',
                ageInputPlaceholder: '请输入您的年龄',
                labelGender: '性别：',
                genderPlaceholder: '请选择性别',
                genderMale: '男',
                genderFemale: '女',
                labelWeight: '体重 (kg):',
                weightInputPlaceholder: '请输入您的体重 (kg)',
                labelHeight: '身高 (m):',
                heightInputPlaceholder: '请输入您的身高 (m)',
                submitUserInfoBtn: '提交',
                gamePageTitle: '平衡感调节游戏',
                // Tab 标签
                gameTab: '游戏',
                restaurantTab: '餐厅推荐',
                gymTab: '健身房推荐',
                supplementTab: '保健品推荐',
                // 游戏相关
                labelDifficulty: '选择游戏难度：',
                difficultyHigh: '高',
                difficultyMid: '中',
                difficultyEasy: '低',
                currentScoreLabel: '当前平均得分：',
                standardVideoLabel: '标准动作',
                userVideoLabel: '您的实时动作',
                startGameBtn: '开始游戏',
                endGameBtn: '结束游戏',
                // 餐厅推荐
                restaurantTitle: '健康餐厅推荐',
                getLocationBtn: '获取我的位置并推荐餐厅',
                locationStatus: '正在获取您的位置...',
                locationSuccess: '位置获取成功！为您推荐附近的餐厅：',
                locationError: '无法获取位置信息',
                locationDenied: '位置权限被拒绝',
                locationUnavailable: '位置信息不可用',
                locationTimeout: '位置获取超时',
                noRecommendations: '显示一般推荐',
                // 健身房推荐
                gymTitle: '适老健身房推荐',
                getGymBtn: '获取我的位置并推荐健身房',
                gymLocationStatus: '正在获取您的位置...',
                gymLocationSuccess: '位置获取成功！为您推荐附近的健身房：',
                gymLocationError: '无法获取位置信息',
                gymLocationDenied: '位置权限被拒绝',
                gymLocationUnavailable: '位置信息不可用',
                gymLocationTimeout: '位置获取超时',
                noGymRecommendations: '显示一般推荐',
                // 保健品推荐
                supplementTitle: '保健品推荐',
                cardiovascularBtn: '心血管健康',
                proteinBtn: '蛋白质补充',
                jointBtn: '关节健康',
                immunityBtn: '免疫力提升',
                // 推荐卡片标签
                typeLabel: '类型：',
                ratingLabel: '评分：',
                addressLabel: '地址：',
                reasonLabel: '推荐理由：',
                featureLabel: '特色：',
                brandLabel: '品牌：',
                priceLabel: '价格：',
                effectLabel: '功效：',
                // 输入提示和错误消息
                enterLocationPrompt: '请输入您的位置',
                noRestaurantRecommendations: '暂无该地区的餐厅推荐，请尝试其他城市如：香港、台北、上海',
                noGymRecommendationsArea: '暂无该地区的健身房推荐，请尝试其他城市如：香港、台北、上海',
                // 游戏结束
                gameOverTitle: '游戏结束！',
                finalScoreText: '您的最终得分：',
                adviceTitle: '营养补充建议：',
                nutritionAdviceLow: '您的表现还有提升空间。建议多补充蛋白质和钙质，例如牛奶、豆腐、鱼肉，以增强肌肉和骨骼健康。同时，可以尝试低强度的平衡练习。',
                nutritionAdviceLowSupplements: [
                    '维特健灵 - 活关素特强特效胶囊（90 粒）',
                    'Move Free 益节 氨糖软骨素',
                    'Swisse 关节健康片',
                    'Blackmores 关节灵',
                    '健力多 氨糖软骨素钙片',
                    'Kirkland Glucosamine HCl with MSM',
                    'Nature Made TripleFlex',
                    'Schiff Glucosamine Plus MSM',
                    'Puritan\'s Pride Glucosamine Chondroitin MSM',
                    '健安喜 (GNC) 关节健康配方'
                ],
                nutritionAdviceMid: '您的关节需要更多呵护，建议补充关节灵活相关保健品，并适度运动。',
                nutritionAdviceMidSupplements: [
                    '川御一 关节の御守',
                    'Sato 佐藤制药 关节守护',
                    'ORIHIRO 葡萄糖胺',
                    '日本小林制药 关节灵',
                    '善存 关节健康配方',
                    '森下仁丹 关节灵',
                    'DHC 关节灵活片',
                    '永信 关节宝',
                    '台塑生医 关健素',
                    '白兰氏 关键活力胶囊'
                ],
                nutritionAdviceHigh: '您的表现非常出色！请继续保持良好的运动习惯和均衡的饮食。',
                nutritionAdviceHighSupplements: [
                    '医之选 - 液关健',
                    '安美露 关节舒缓液',
                    '葡萄王 关健宝',
                    '康健生技 关健饮',
                    '台塑生医 关健饮',
                    '善存 关键活力饮',
                    '白兰氏 关键饮',
                    'Swisse 关节健康饮',
                    'Move Free 关节饮',
                    'GNC 关节健康饮'
                ],
                restartGameBtn: '重新开始',
                cameraAccessError: '无法访问摄像头，请检查权限设置。',
                invalidInputError: '请填写有效的年龄、体重和身高！',
                enterLocationPrompt: '请输入您的位置',
                noRestaurantRecommendations: '暂无该地区的餐厅推荐，请尝试其他城市如：香港、台北、上海',
                noGymRecommendationsArea: '暂无该地区的健身房推荐，请尝试其他城市如：香港、台北、上海'
            },
            'en': {
                appTitle: 'Elderly Health Assistant',
                welcomeMessage: 'Welcome to the Elderly Health Assistant!',
                recommendationTitle: 'Health Recommendations',
                mealPlanTitle: 'Meal Plan',
                gameTitle: 'Brain Games',
                languageToggle: 'Language Toggle',
                gameInstructions: 'Click the button below to start the game:',
                startGame: 'Start Game',
                stopGame: 'Stop Game',
                gameScore: 'Score',
                gameTime: 'Time',
                brandLabel: 'Brand: ',
                ratingLabel: 'Rating: ',
                priceLabel: 'Price: ',
                effectLabel: 'Effect: ',
                disclaimerTitle: 'Disclaimer',
                disclaimerText: 'The content of this website does not constitute professional medical advice. Please choose appropriate activities based on your physical condition. The suggestions provided by this website are for reference only and do not constitute any medical advice. If you feel unwell, please seek medical attention promptly. This website does not collect your personal data or save any videos. Any information you enter on this website is solely for the purpose of recommending more suitable mini-games for you, and it will not be uploaded to our servers.',
                confirmDisclaimerBtn: 'I have read and agree',
                userInfoTitle: 'Please Enter Your Information',
                labelAge: 'Age:',
                ageInputPlaceholder: 'Enter your age',
                labelGender: 'Gender:',
                genderPlaceholder: 'Select Gender',
                genderMale: 'Male',
                genderFemale: 'Female',
                labelWeight: 'Weight (kg):',
                weightInputPlaceholder: 'Enter your weight (kg)',
                labelHeight: 'Height (m):',
                heightInputPlaceholder: 'Enter your height (m)',
                submitUserInfoBtn: 'Submit',
                gamePageTitle: 'Balance Training Game',
                // Tab labels
                gameTab: 'Game',
                restaurantTab: 'Restaurant Recommendations',
                gymTab: 'Gym Recommendations',
                supplementTab: 'Supplement Recommendations',
                // Game related
                labelDifficulty: 'Select Game Difficulty:',
                difficultyHigh: 'High',
                difficultyMid: 'Mid',
                difficultyEasy: 'Low',
                currentScoreLabel: 'Current Average Score:',
                standardVideoLabel: 'Standard Movement',
                userVideoLabel: 'Your Live Movement',
                startGameBtn: 'Start Game',
                endGameBtn: 'End Game',
                // Restaurant recommendations
                restaurantTitle: 'Healthy Restaurant Recommendations',
                getLocationBtn: 'Get My Location & Recommend Restaurants',
                locationStatus: 'Getting your location...',
                locationSuccess: 'Location found! Here are nearby restaurants for you:',
                locationError: 'Unable to get location information',
                locationDenied: 'Location permission denied',
                locationUnavailable: 'Location information unavailable',
                locationTimeout: 'Location request timed out',
                noRecommendations: 'Showing general recommendations',
                // Gym recommendations
                gymTitle: 'Senior-Friendly Gym Recommendations',
                getGymBtn: 'Get My Location & Recommend Gyms',
                gymLocationStatus: 'Getting your location...',
                gymLocationSuccess: 'Location found! Here are nearby gyms for you:',
                gymLocationError: 'Unable to get location information',
                gymLocationDenied: 'Location permission denied',
                gymLocationUnavailable: 'Location information unavailable',
                gymLocationTimeout: 'Location request timed out',
                noGymRecommendations: 'Showing general recommendations',
                // Supplement recommendations
                supplementTitle: 'Health Supplement Recommendations',
                cardiovascularBtn: 'Cardiovascular Health',
                proteinBtn: 'Protein Supplement',
                jointBtn: 'Joint Health',
                immunityBtn: 'Immunity Boost',
                // 推荐卡片标签
                typeLabel: 'Type:',
                ratingLabel: 'Rating:',
                addressLabel: 'Address:',
                reasonLabel: 'Reason:',
                featureLabel: 'Features:',
                brandLabel: 'Brand:',
                priceLabel: 'Price:',
                effectLabel: 'Effect:',
                // Game over
                gameOverTitle: 'Game Over!',
                finalScoreText: 'Your Final Score:',
                adviceTitle: 'Nutritional Advice:',
                nutritionAdviceLow: 'Your performance has room for improvement. It is recommended to supplement protein and calcium, such as milk, tofu, and fish, to strengthen muscle and bone health. You can also try low-intensity balance exercises.',
                nutritionAdviceLowSupplements: [
                    'Vita Green VitaJoint Extra Strength Capsules (90 capsules)',
                    'Move Free Joint Health',
                    'Swisse Joint Health Tablets',
                    'Blackmores Joint Formula',
                    'Caltrate Joint Health',
                    'Kirkland Glucosamine HCl with MSM',
                    'Nature Made TripleFlex',
                    'Schiff Glucosamine Plus MSM',
                    'Puritan\'s Pride Glucosamine Chondroitin MSM',
                    'GNC Joint Health Formula'
                ],
                nutritionAdviceMid: 'Your joints need more care. Consider joint flexibility supplements and moderate exercise.',
                nutritionAdviceMidSupplements: [
                    'Kawaguchi Joint Guardian',
                    'Sato Joint Support',
                    'ORIHIRO Glucosamine',
                    'Kobayashi Joint Formula',
                    'Centrum Joint Health',
                    'Morishita Jintan Joint',
                    'DHC Joint Tablets',
                    'Yung Shin Joint Care',
                    'Formosa Biomedical Joint Formula',
                    'Brand\'s Joint Vitality Capsules'
                ],
                nutritionAdviceHigh: 'Excellent performance! Please continue to maintain good exercise habits and a balanced diet.',
                nutritionAdviceHighSupplements: [
                    'EZZ Liquid Joint',
                    'Amrutanjan Joint Relief Liquid',
                    'Grape King Joint Care',
                    'Health Bio Joint Drink',
                    'Formosa Biomedical Joint Drink',
                    'Centrum Joint Vitality Drink',
                    'Brand\'s Joint Drink',
                    'Swisse Joint Health Drink',
                    'Move Free Joint Drink',
                    'GNC Joint Health Drink'
                ],
                restartGameBtn: 'Restart Game',
                cameraAccessError: 'Unable to access camera, please check permissions.',
                invalidInputError: 'Please enter valid age, weight, and height!',
                enterLocationPrompt: 'Please enter your location',
                noRestaurantRecommendations: 'No restaurant recommendations for this area. Try other cities like: Hong Kong, Taipei, Shanghai',
                noGymRecommendationsArea: 'No gym recommendations for this area. Try other cities like: Hong Kong, Taipei, Shanghai'
            }
        };

        let currentLanguage = 'zh-CN'; // 默认语言为中文

        // 根据当前语言更新所有文本内容
        function updateLanguage() {
            // 更新通用文本
            document.getElementById('appTitle').textContent = translations[currentLanguage].appTitle;
            // 更新免责声明模态框文本
            document.getElementById('disclaimerTitle').textContent = translations[currentLanguage].disclaimerTitle;
            document.getElementById('disclaimerText').textContent = translations[currentLanguage].disclaimerText;
            document.getElementById('confirmDisclaimerBtn').textContent = translations[currentLanguage].confirmDisclaimerBtn;

            // 更新用户信息页面文本
            document.getElementById('userInfoTitle').textContent = translations[currentLanguage].userInfoTitle;
            document.getElementById('labelAge').textContent = translations[currentLanguage].labelAge;
            document.getElementById('ageInput').placeholder = translations[currentLanguage].ageInputPlaceholder;
            document.getElementById('labelGender').textContent = translations[currentLanguage].labelGender;
            document.getElementById('genderPlaceholder').textContent = translations[currentLanguage].genderPlaceholder;
            document.getElementById('genderMale').textContent = translations[currentLanguage].genderMale;
            document.getElementById('genderFemale').textContent = translations[currentLanguage].genderFemale;
            document.getElementById('labelWeight').textContent = translations[currentLanguage].labelWeight;
            document.getElementById('weightInput').placeholder = translations[currentLanguage].weightInputPlaceholder;
            document.getElementById('labelHeight').textContent = translations[currentLanguage].labelHeight;
            document.getElementById('heightInput').placeholder = translations[currentLanguage].heightInputPlaceholder;
            document.getElementById('submitUserInfoBtn').textContent = translations[currentLanguage].submitUserInfoBtn;

            // 更新游戏页面文本
            document.getElementById('gamePageTitle').textContent = translations[currentLanguage].gamePageTitle;
            
            // 更新 Tab 标签
            document.getElementById('gameTab').textContent = translations[currentLanguage].gameTab;
            document.getElementById('restaurantTab').textContent = translations[currentLanguage].restaurantTab;
            document.getElementById('gymTab').textContent = translations[currentLanguage].gymTab;
            document.getElementById('supplementTab').textContent = translations[currentLanguage].supplementTab;
            
            // 更新游戏相关文本
            document.getElementById('labelDifficulty').textContent = translations[currentLanguage].labelDifficulty;
            document.getElementById('difficultyHigh').textContent = translations[currentLanguage].difficultyHigh;
            document.getElementById('difficultyMid').textContent = translations[currentLanguage].difficultyMid;
            document.getElementById('difficultyEasy').textContent = translations[currentLanguage].difficultyEasy;
            document.getElementById('currentScoreLabel').textContent = translations[currentLanguage].currentScoreLabel;
            document.getElementById('standardVideoLabel').textContent = translations[currentLanguage].standardVideoLabel;
            document.getElementById('userVideoLabel').textContent = translations[currentLanguage].userVideoLabel;
            document.getElementById('startGameBtn').textContent = translations[currentLanguage].startGameBtn;

            // 更新餐厅推荐文本
            document.getElementById('restaurantTitle').textContent = translations[currentLanguage].restaurantTitle;
            document.getElementById('getLocationBtn').textContent = translations[currentLanguage].getLocationBtn;
            
            // 更新健身房推荐文本
            document.getElementById('gymTitle').textContent = translations[currentLanguage].gymTitle;
            document.getElementById('getGymBtn').textContent = translations[currentLanguage].getGymBtn;
            
            // 更新保健品推荐文本
            document.getElementById('supplementTitle').textContent = translations[currentLanguage].supplementTitle;
            document.getElementById('cardiovascularBtn').textContent = translations[currentLanguage].cardiovascularBtn;
            document.getElementById('proteinBtn').textContent = translations[currentLanguage].proteinBtn;
            document.getElementById('jointBtn').textContent = translations[currentLanguage].jointBtn;
            document.getElementById('immunityBtn').textContent = translations[currentLanguage].immunityBtn;

            // 更新游戏结束模态框文本
            document.getElementById('gameOverTitle').textContent = translations[currentLanguage].gameOverTitle;
            document.getElementById('finalScoreText').textContent = translations[currentLanguage].finalScoreText;
            document.getElementById('adviceTitle').textContent = translations[currentLanguage].adviceTitle;
            document.getElementById('nutritionAdvice').textContent = translations[currentLanguage].nutritionAdviceLow; // 初始设置为低档建议，后续会更新
            document.getElementById('restartGameBtn').textContent = translations[currentLanguage].restartGameBtn;

            // 根据游戏状态更新开始/结束按钮文本
            if (isGameRunning) {
                document.getElementById('startGameBtn').textContent = translations[currentLanguage].endGameBtn;
            } else {
                document.getElementById('startGameBtn').textContent = translations[currentLanguage].startGameBtn;
            }
        }

        // 语言切换下拉框事件监听
        document.getElementById('languageSelect').addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            updateLanguage();
            // 刷新当前显示的推荐内容
            refreshCurrentRecommendations();
        });

        // --- 页面导航逻辑 ---
        const disclaimerModal = document.getElementById('disclaimerModal');
        const userInfoPage = document.getElementById('userInfoPage');
        const gamePage = document.getElementById('gamePage');
        const gameOverModal = document.getElementById('gameOverModal');

        // 显示指定页面，隐藏其他页面
        function showPage(pageElement) {
            const pages = [userInfoPage, gamePage, disclaimerModal, gameOverModal];
            pages.forEach(page => {
                if (page) {
                    page.style.removeProperty('display');
                    page.style.display = 'none';
                }
            });
            if (pageElement === disclaimerModal || pageElement === gameOverModal) {
                pageElement.style.removeProperty('display');
                pageElement.style.display = 'flex';
            } else {
                pageElement.style.removeProperty('display');
                pageElement.style.display = 'block';
            }
        }

        // 网页加载完成后，首先显示免责声明模态框并初始化语言
        window.onload = async () => {
            updateLanguage(); // 设置初始语言
            showPage(disclaimerModal);
            // 异步创建 PoseLandmarker 实例，确保在 DOM 加载和模块解析完成后进行
            // 使用 setTimeout 0 延迟，确保所有模块加载完毕
            setTimeout(async () => {
                await createPoseLandmarker();
            }, 0);
        };

        // 免责声明确认按钮点击事件
        document.getElementById('confirmDisclaimerBtn').addEventListener('click', () => {
            showPage(userInfoPage);
        });

        // --- 用户信息收集与 BMI 计算 ---
        let userAge, userWeight, userHeight;

        // 提交用户信息按钮点击事件
        document.getElementById('submitUserInfoBtn').addEventListener('click', () => {
            userAge = parseInt(document.getElementById('ageInput').value);
            userWeight = parseFloat(document.getElementById('weightInput').value);
            userHeight = parseFloat(document.getElementById('heightInput').value);

            // 验证输入是否有效
            if (isNaN(userAge) || isNaN(userWeight) || isNaN(userHeight) || userAge <= 0 || userWeight <= 0 || userHeight <= 0) {
                // 使用自定义弹窗或更友好的 UI 提示代替 alert
                alert(translations[currentLanguage].invalidInputError);
                return;
            }

            // 计算 BMI
            const bmi = userWeight / (userHeight * userHeight);
            let defaultDifficulty = 'mid'; // 默认难度为中等

            // 根据年龄和 BMI 设置默认游戏难度
            if (userAge > 70) {
                defaultDifficulty = 'easy'; // 70 岁以上，默认低难度
            } else if (bmi < 18.5) { // 偏瘦
                defaultDifficulty = 'high';
            } else if (bmi >= 18.5 && bmi < 24) { // 正常体重 (参考亚洲标准)
                defaultDifficulty = 'high';
            } else if (bmi >= 24 && bmi < 28) { // 超重
                defaultDifficulty = 'mid';
            } else if (bmi >= 28) { // 肥胖
                defaultDifficulty = 'easy';
            }

            document.getElementById('difficultySelect').value = defaultDifficulty; // 设置下拉框的默认值
            currentStandardVideo = `assets/${defaultDifficulty}.mp4`; // 设置标准视频路径
            document.getElementById('standardVideo').src = currentStandardVideo; // 加载标准视频

            showPage(gamePage); // 显示游戏页面
            setupCamera(); // 设置并启动摄像头
        });

        // --- 游戏核心逻辑变量 ---
        const userVideo = document.getElementById('userVideo');
        const standardVideo = document.getElementById('standardVideo');
        const userCanvas = document.getElementById('userCanvas');
        const standardCanvas = document.getElementById('standardCanvas');
        const countdownDisplay = document.getElementById('countdownDisplay');
        const averageScoreDisplay = document.getElementById('averageScoreDisplay');
        const startGameBtn = document.getElementById('startGameBtn');
        const difficultySelect = document.getElementById('difficultySelect');

        let userVideoCtx = userCanvas.getContext('2d');
        let standardVideoCtx = standardCanvas.getContext('2d');
        let poseLandmarker; // MediaPipe PoseLandmarker 实例
        let runningMode = "VIDEO"; // MediaPipe 运行模式
        let lastVideoTime = -1; // 记录上一帧视频时间，避免重复处理
        let userDrawingUtils; // 用于在用户视频 Canvas 上绘制
        let standardDrawingUtils; // 用于在标准视频 Canvas 上绘制
        let currentStandardVideo = 'assets/mid.mp4'; // 当前标准视频路径，默认中等难度
        let isGameRunning = false; // 游戏是否正在进行
        let animationFrameId; // requestAnimationFrame 的 ID，用于控制动画循环
        let countdownTimer; // 倒计时定时器
        let totalScore = 0; // 总得分
        let frameCount = 0; // 已处理的帧数
        let enablePoseDetection = false; // 是否启用姿态检测（在倒计时结束后开启）

        // --- MediaPipe PoseLandmarker 初始化 ---
        async function createPoseLandmarker() {
            console.log("Attempting to create PoseLandmarker...");
            // 从 CDN 加载 MediaPipe 的 WASM 文件
            const vision = await FilesetResolver.forVisionTasks(
                "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"
            );
            console.log("FilesetResolver for vision tasks loaded.");
            // 创建 PoseLandmarker 实例，加载轻量级模型，并设置 GPU 加速
            poseLandmarker = await PoseLandmarker.createFromOptions(vision, {
                baseOptions: {
                    modelAssetPath: `https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task`,
                    delegate: "GPU"
                },
                runningMode: runningMode,
                numPoses: 1 // 只检测一个人体
            });
            console.log("PoseLandmarker loaded successfully.");
        }

        // --- 摄像头设置 ---
        async function setupCamera() {
            // 检查浏览器是否支持 getUserMedia
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert(translations[currentLanguage].cameraAccessError);
                return;
            }

            try {
                // 请求访问用户摄像头
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                userVideo.srcObject = stream; // 将视频流设置到 userVideo 元素
                // 视频数据加载完成后，设置 Canvas 尺寸并获取 2D 上下文和绘图工具
                userVideo.addEventListener('loadeddata', () => {
                    userCanvas.width = userVideo.videoWidth;
                    userCanvas.height = userVideo.videoHeight;
                    userVideoCtx = userCanvas.getContext('2d');
                    userDrawingUtils = new DrawingUtils(userVideoCtx);
                    console.log("User video loaded and canvas sized.");
                    userVideo.play(); // 确保用户视频自动播放
                });
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert(translations[currentLanguage].cameraAccessError);
            }
        }

        // --- 标准视频设置 ---
        // 游戏难度下拉框改变时，更新标准视频源
        difficultySelect.addEventListener('change', () => {
            if (!isGameRunning) { // 只有在游戏未运行时才能切换视频
                currentStandardVideo = `assets/${difficultySelect.value}.mp4`;
                standardVideo.src = currentStandardVideo;
            }
        });

        // 标准视频数据加载完成后，设置 Canvas 尺寸并获取 2D 上下文和绘图工具
        standardVideo.addEventListener('loadeddata', () => {
            standardCanvas.width = standardVideo.videoWidth;
            standardCanvas.height = standardVideo.videoHeight;
            standardVideoCtx = standardCanvas.getContext('2d');
            standardDrawingUtils = new DrawingUtils(standardVideoCtx);
            console.log("Standard video loaded and canvas sized.");
        });
        // 保证 canvas 在视频尺寸变化时也同步
        standardVideo.addEventListener('resize', () => {
            standardCanvas.width = standardVideo.videoWidth;
            standardCanvas.height = standardVideo.videoHeight;
        });

        // --- 姿态检测循环 ---
        async function predictWebcam() {
            // 如果 PoseLandmarker 未加载或姿态检测未启用，则继续下一帧动画
            if (!poseLandmarker || !enablePoseDetection) {
                animationFrameId = requestAnimationFrame(predictWebcam);
                return;
            }

            let userResults = null;
            // 仅当用户视频时间更新时才进行检测
            if (userVideo.currentTime !== lastVideoTime) {
                lastVideoTime = userVideo.currentTime;
                // 对用户视频进行姿态检测
                userResults = poseLandmarker.detectForVideo(userVideo, performance.now());
            }

            let standardResults = null;
            // 只有当标准视频正在播放时才进行检测
            if (standardVideo.currentTime > 0 && !standardVideo.paused && !standardVideo.ended) {
                // 从当前标准视频帧创建 ImageBitmap，以便 MediaPipe 处理
                const standardImageBitmap = await createImageBitmap(standardVideo);
                // 对标准视频帧进行姿态检测
                standardResults = poseLandmarker.detectForVideo(standardImageBitmap, performance.now());
            }

            // 清空 Canvas，准备绘制新帧
            userVideoCtx.clearRect(0, 0, userCanvas.width, userCanvas.height);
            standardVideoCtx.clearRect(0, 0, standardCanvas.width, standardCanvas.height);

            // 绘制用户姿态骨骼点和连接线
            if (userResults && userResults.landmarks && userResults.landmarks.length > 0) {
                for (const landmark of userResults.landmarks) {
                    userDrawingUtils.drawConnectors(landmark, PoseLandmarker.POSE_CONNECTIONS, { color: "#00FF00", lineWidth: 4 }); // 绿色连接线
                    userDrawingUtils.drawLandmarks(landmark, { radius: 5, color: "#FF0000" }); // 红色骨骼点
                }
            }

            // 绘制标准姿态骨骼点和连接线
            if (standardResults && standardResults.landmarks && standardResults.landmarks.length > 0) {
                for (const landmark of standardResults.landmarks) {
                    standardDrawingUtils.drawConnectors(landmark, PoseLandmarker.POSE_CONNECTIONS, { color: "#00FFFF", lineWidth: 4 }); // 青色连接线
                    standardDrawingUtils.drawLandmarks(landmark, { radius: 5, color: "#FF00FF" }); // 紫色骨骼点
                }
            }

            // 如果用户和标准视频都检测到了姿态，则计算并显示得分
            if (userResults && userResults.landmarks && userResults.landmarks.length > 0 &&
                standardResults && standardResults.landmarks && standardResults.landmarks.length > 0) {
                calculateAndDisplayScore(userResults.landmarks[0], standardResults.landmarks[0]);
            }

            // 继续下一帧动画循环
            animationFrameId = requestAnimationFrame(predictWebcam);
        }

        // --- 得分计算逻辑 (余弦相似度) ---
        // 定义用于计算余弦相似度的关键关节对（骨骼向量）
        // 具体的关节索引可以参考 MediaPipe Pose 的官方文档
        const JOINT_PAIRS = [
            // 左右臂
            [11, 13], // 左肩到左肘
            [13, 15], // 左肘到左腕
            [12, 14], // 右肩到右肘
            [14, 16], // 右肘到右腕
            // 左右腿
            [23, 25], // 左髋到左膝
            [25, 27], // 左膝到左踝
            [24, 26], // 右髋到右膝
            [26, 28], // 右膝到右踝
            // 躯干部分
            [11, 23], // 左肩到左髋
            [12, 24], // 右肩到右髋
            [11, 12], // 双肩（用于水平对齐）
            [23, 24]  // 双髋（用于水平对齐）
        ];

        // 获取两点之间的向量
        function getVector(p1, p2) {
            return { x: p2.x - p1.x, y: p2.y - p1.y, z: p2.z - p1.z };
        }

        // 计算向量点积
        function dotProduct(v1, v2) {
            return v1.x * v2.x + v1.y * v2.y + v1.z * v2.z;
        }

        // 计算向量的模（长度）
        function magnitude(v) {
            return Math.sqrt(v.x * v.x + v.y * v.y + v.z - v.z);
        }

        // 计算两个向量的余弦相似度
        function cosineSimilarity(v1, v2) {
            const mag1 = magnitude(v1);
            const mag2 = magnitude(v2);
            if (mag1 === 0 || mag2 === 0) return 0; // 避免除以零
            // 余弦相似度公式：(v1 . v2) / (|v1| * |v2|)
            return dotProduct(v1, v2) / (mag1 * mag2);
        }

        // 计算并显示当前帧得分
        function calculateAndDisplayScore(userLandmarks, standardLandmarks) {
            let frameScore = 0; // 当前帧的总相似度
            let validVectorPairs = 0; // 有效的向量对数量

            // 遍历所有定义的关节对
            for (const [idx1, idx2] of JOINT_PAIRS) {
                const userP1 = userLandmarks[idx1];
                const userP2 = userLandmarks[idx2];
                const standardP1 = standardLandmarks[idx1];
                const standardP2 = standardLandmarks[idx2];

                // 确保关键点都存在
                if (userP1 && userP2 && standardP1 && standardP2) {
                    const userVec = getVector(userP1, userP2);
                    const standardVec = getVector(standardP1, standardP2);

                    const similarity = cosineSimilarity(userVec, standardVec);
                    // 余弦相似度范围是 -1 到 1。为了方便计分，将其映射到 0 到 1 的范围：(similarity + 1) / 2
                    frameScore += (similarity + 1) / 2;
                    validVectorPairs++;
                }
            }

            if (validVectorPairs > 0) {
                const averageSimilarity = frameScore / validVectorPairs; // 计算平均相似度
                const score = Math.round(averageSimilarity * 100); // 将相似度转换为 0-100 的得分
                totalScore += score; // 累加总分
                frameCount++; // 增加帧计数
                // 更新显示当前平均得分
                averageScoreDisplay.textContent = Math.round(totalScore / frameCount);
            }
        }

        // --- 游戏开始/结束逻辑 ---
        startGameBtn.addEventListener('click', () => {
            if (!isGameRunning) {
                startGame(); // 如果游戏未开始，则启动游戏
            } else {
                endGame(); // 如果游戏正在进行，则结束游戏
            }
        });

        // 启动游戏流程
        async function startGame() {
            // 检查 MediaPipe 模型是否加载完成
            if (!poseLandmarker) {
                alert('MediaPipe 模型正在加载中，请稍候...');
                return;
            }
            // 检查摄像头是否已成功访问
            if (!userVideo.srcObject) {
                alert(translations[currentLanguage].cameraAccessError);
                return;
            }

            isGameRunning = true;
            startGameBtn.textContent = translations[currentLanguage].endGameBtn; // 更改按钮文本为"结束游戏"
            totalScore = 0; // 重置总分
            frameCount = 0; // 重置帧计数
            averageScoreDisplay.textContent = '0'; // 重置显示得分
            difficultySelect.disabled = true; // 游戏进行中禁用难度选择

            // 显示倒计时
            countdownDisplay.classList.remove('hidden');
            let count = 3;
            countdownDisplay.textContent = count;
            countdownTimer = setInterval(() => {
                count--;
                countdownDisplay.textContent = count;
                if (count === 0) {
                    clearInterval(countdownTimer); // 清除倒计时定时器
                    countdownDisplay.classList.add('hidden'); // 隐藏倒计时
                    startPoseDetection(); // 开始姿态检测
                }
            }, 1000);
        }

        // 实际开始姿态检测和视频播放
        function startPoseDetection() {
            standardVideo.play(); // 播放标准视频
            userVideo.play(); // 确保用户摄像头视频播放
            enablePoseDetection = true; // 启用姿态检测
            // 启动 MediaPipe 预测循环
            animationFrameId = requestAnimationFrame(predictWebcam);
            // 监听标准视频播放结束事件，自动结束游戏
            standardVideo.addEventListener('ended', endGame, { once: true });
        }

        // 结束游戏流程
        function endGame() {
            isGameRunning = false;
            enablePoseDetection = false; // 禁用姿态检测
            startGameBtn.textContent = translations[currentLanguage].startGameBtn; // 恢复按钮文本为"开始游戏"
            difficultySelect.disabled = false; // 重新启用难度选择

            clearInterval(countdownTimer); // 清除倒计时
            cancelAnimationFrame(animationFrameId); // 取消动画帧循环

            userVideo.pause(); // 暂停用户视频
            standardVideo.pause(); // 暂停标准视频
            standardVideo.currentTime = 0; // 标准视频重置到开头

            // 清空 Canvas 内容
            userVideoCtx.clearRect(0, 0, userCanvas.width, userCanvas.height);
            standardVideoCtx.clearRect(0, 0, standardCanvas.width, standardCanvas.height);

            showGameOverModal(); // 显示游戏结束模态框
        }

        // 显示游戏结束模态框并提供建议
        function showGameOverModal() {
            // 计算最终平均得分
            const finalScore = frameCount > 0 ? Math.round(totalScore / frameCount) : 0;
            document.getElementById('finalScoreDisplay').textContent = finalScore;

            let adviceText = '';
            let supplement = '';
            // 根據分數區間推薦不同保健品
            if (finalScore < 50) {
                const supplements = translations[currentLanguage].nutritionAdviceLowSupplements;
                supplement = supplements[Math.floor(Math.random() * supplements.length)];
                adviceText = `${translations[currentLanguage].nutritionAdviceLow}<br><strong style='color:#d97706;'>推薦：${supplement}</strong>`;
                document.getElementById('nutritionAdvice').innerHTML = adviceText;
            } else if (finalScore >= 50 && finalScore < 150) {
                const supplements = translations[currentLanguage].nutritionAdviceMidSupplements;
                supplement = supplements[Math.floor(Math.random() * supplements.length)];
                adviceText = `${translations[currentLanguage].nutritionAdviceMid}<br><strong style='color:#2563eb;'>推薦：${supplement}</strong>`;
                document.getElementById('nutritionAdvice').innerHTML = adviceText;
            } else if (finalScore >= 150) {
                const supplements = translations[currentLanguage].nutritionAdviceHighSupplements;
                supplement = supplements[Math.floor(Math.random() * supplements.length)];
                adviceText = `${translations[currentLanguage].nutritionAdviceHigh}<br><strong style='color:#059669;'>推薦：${supplement}</strong>`;
                document.getElementById('nutritionAdvice').innerHTML = adviceText;
            }
            document.getElementById('nutritionAdvice').innerHTML = adviceText;
            showPage(gameOverModal); // 显示游戏结束模态框
        }

        // 重新开始游戏按钮点击事件
        document.getElementById('restartGameBtn').addEventListener('click', () => {
            showPage(gamePage); // 返回游戏主页面
            averageScoreDisplay.textContent = '0'; // 重置得分显示
            userVideo.play(); // 确保用户摄像头视频继续播放
        });

        // 确保用户视频在离开游戏页面后不会暂停，以便返回时能立即使用
        userVideo.addEventListener('pause', () => {
            if (isGameRunning) userVideo.play(); // 如果游戏正在进行，则保持播放
        });
        userVideo.addEventListener('ended', () => {
            if (isGameRunning) userVideo.play(); // 如果用户视频结束（不应该发生，但以防万一），重新播放
        });

        // 自动播放音乐
        window.addEventListener('DOMContentLoaded', () => {
            const audio = document.getElementById('bgm');
            if (audio) {
                audio.volume = 0.5;
                audio.play().catch(() => {
                    // 部分浏览器需用户交互后播放
                    document.body.addEventListener('click', () => audio.play(), { once: true });
                });
            }
        });

        // --- Tab 切换功能 ---
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');
                
                // 移除所有活跃状态
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // 添加活跃状态
                button.classList.add('active');
                document.getElementById(targetTab + 'Content').classList.add('active');
            });
        });

        // --- 餐厅推荐功能 ---
        const restaurantData = {
            '香港': [
                { name: '大家樂', type: '港式茶餐廳', rating: '4.2/5', address: '全港多個分店', description: '提供清淡粥品、蒸蛋、白切雞等適合長者的健康選擇' },
                { name: '一粥麵', type: '粥麵專門店', rating: '4.3/5', address: '全港多個分店', description: '專營各式養生粥品，少油少鹽，營養豐富' },
                { name: '美心餐廳', type: '港式餐廳', rating: '4.1/5', address: '全港多個分店', description: '提供蒸魚、白灼菜心等清淡菜式' },
                { name: '翠華餐廳', type: '茶餐廳', rating: '4.0/5', address: '全港多個分店', description: '有清湯麵條、蒸蛋等適合長者的選擇' }
            ],
            '台北': [
                { name: '鬍鬚張', type: '台式小吃', rating: '4.1/5', address: '台北多個分店', description: '滷肉飯口味清淡，適合長者' },
                { name: '永和豆漿', type: '早餐店', rating: '4.0/5', address: '台北多個分店', description: '豆漿、稀飯等清淡營養早餐' },
                { name: '鼎泰豐', type: '小籠包', rating: '4.5/5', address: '信義區、中山區等', description: '清湯小籠包，製作精細' }
            ],
            '上海': [
                { name: '南翔饅頭店', type: '上海小吃', rating: '4.2/5', address: '豫園、淮海路等', description: '清湯小籠包，口味清淡' },
                { name: '老盛昌', type: '湯包店', rating: '4.1/5', address: '上海多個分店', description: '各式清湯湯包，營養豐富' },
                { name: '新雅粤菜館', type: '粵菜', rating: '4.4/5', address: '南京東路', description: '清蒸魚、白切雞等清淡粵菜' }
            ]
        };

        document.getElementById('getLocationBtn').addEventListener('click', () => {
            // 直接调用地理位置功能获取餐厅推荐
            handleRestaurantLocation();
        });

        // --- 健身房推荐功能 ---
        const gymData = {
            '香港': [
                { name: 'Pure Fitness', type: '連鎖健身房', rating: '4.3/5', address: '中環、銅鑼灣等', description: '設有長者專屬時段，提供水中運動、太極等適合長者的課程' },
                { name: 'Fitness First', type: '國際連鎖', rating: '4.2/5', address: '全港多個分店', description: '有專業教練指導，提供低強度運動課程' },
                { name: '康文署體育館', type: '公共設施', rating: '4.0/5', address: '各區體育館', description: '收費便宜，設有長者健身器材和太極班' },
                { name: 'YMCA', type: '基督教青年會', rating: '4.1/5', address: '中環、尖沙咀等', description: '專為長者設計的運動課程，包括水療和輕量訓練' }
            ],
            '台北': [
                { name: 'World Gym', type: '連鎖健身房', rating: '4.2/5', address: '台北多個分店', description: '設有銀髮族專區，提供適合長者的運動器材' },
                { name: '健身工廠', type: '本土連鎖', rating: '4.1/5', address: '台北多個分店', description: '價格親民，有長者友善的運動課程' },
                { name: '台北市運動中心', type: '公共設施', rating: '4.0/5', address: '各區運動中心', description: '公營設施，提供長者專屬運動時段' },
                { name: 'Curves', type: '女性專用', rating: '4.3/5', address: '台北多個分店', description: '30 分鐘循環運動，適合長者女性' }
            ],
            '上海': [
                { name: '威爾士健身', type: '連鎖健身房', rating: '4.2/5', address: '上海多個分店', description: '設有長者運動課程，專業教練指導' },
                { name: '一兆韋德', type: '本土連鎖', rating: '4.1/5', address: '上海多個分店', description: '提供太極、瑜伽等適合長者的課程' },
                { name: '上海市民健身中心', type: '公共設施', rating: '4.0/5', address: '各區健身中心', description: '政府運營，收費低廉，設施完善' },
                { name: '舒適堡', type: '高端健身', rating: '4.4/5', address: '浦東、徐匯等', description: '環境舒適，有專門的長者運動區域' }
            ]
        };

        document.getElementById('getGymBtn').addEventListener('click', () => {
            // 直接调用地理位置功能获取健身房推荐
            handleGymLocation();
        });

        // --- 保健品推荐功能 ---
        const supplementData = {
            'zh-CN': {
                cardiovascular: [
                    { name: '深海魚油', brand: 'Nordic Naturals', rating: '4.5/5', price: 'HK$280-350', description: '富含 Omega-3，有助心血管健康，降低血脂' },
                    { name: '輔酶 Q10', brand: 'Life Extension', rating: '4.4/5', price: 'HK$320-400', description: '保護心肌，改善心臟功能，抗氧化' },
                    { name: '納豆激酶', brand: '日本味王', rating: '4.3/5', price: 'HK$200-280', description: '幫助血液循環，預防血栓形成' },
                    { name: '紅麴', brand: '統一生機', rating: '4.2/5', price: 'HK$150-200', description: '天然降膽固醇，維護心血管健康' }
                ],
                protein: [
                    { name: '乳清蛋白', brand: 'Optimum Nutrition', rating: '4.6/5', price: 'HK$400-500', description: '易吸收蛋白質，維持肌肉量，適合長者' },
                    { name: '膠原蛋白', brand: 'DHC', rating: '4.3/5', price: 'HK$180-250', description: '維持皮膚彈性，保護關節軟骨' },
                    { name: '植物蛋白', brand: 'Garden of Life', rating: '4.4/5', price: 'HK$350-450', description: '植物性蛋白質，易消化，適合素食者' },
                    { name: '胺基酸複合物', brand: 'NOW Foods', rating: '4.2/5', price: 'HK$200-300', description: '全面胺基酸補充，促進蛋白質合成' }
                ],
                joint: [
                    { name: '葡萄糖胺', brand: 'Move Free', rating: '4.4/5', price: 'HK$250-350', description: '維護關節軟骨，減緩關節退化' },
                    { name: '軟骨素', brand: 'Schiff', rating: '4.3/5', price: 'HK$300-400', description: '保護關節，減少關節疼痛和僵硬' },
                    { name: 'MSM 有機硫', brand: 'Puritan\'s Pride', rating: '4.2/5', price: 'HK$180-250', description: '天然抗炎，改善關節靈活性' },
                    { name: '薑黃素', brand: 'Swanson', rating: '4.5/5', price: 'HK$150-220', description: '強效抗炎，緩解關節不適' }
                ],
                immunity: [
                    { name: '維生素 C', brand: 'Emergen-C', rating: '4.4/5', price: 'HK$120-180', description: '增強免疫力，抗氧化，促進鐵質吸收' },
                    { name: '維生素 D3', brand: 'Nature Made', rating: '4.5/5', price: 'HK$100-150', description: '強化骨骼，調節免疫系統' },
                    { name: '益生菌', brand: 'Culturelle', rating: '4.3/5', price: 'HK$280-350', description: '改善腸道健康，增強免疫力' },
                    { name: '蜂膠', brand: '澳洲 Comvita', rating: '4.2/5', price: 'HK$200-280', description: '天然抗菌，提升免疫防護' }
                ]
            },
            'zh-TW': {
                cardiovascular: [
                    { name: '深海魚油', brand: 'Nordic Naturals', rating: '4.5/5', price: 'HK$280-350', description: '富含 Omega-3，有助心血管健康，降低血脂' },
                    { name: '輔酶 Q10', brand: 'Life Extension', rating: '4.4/5', price: 'HK$320-400', description: '保護心肌，改善心臟功能，抗氧化' },
                    { name: '納豆激酶', brand: '日本味王', rating: '4.3/5', price: 'HK$200-280', description: '幫助血液循環，預防血栓形成' },
                    { name: '紅麴', brand: '統一生機', rating: '4.2/5', price: 'HK$150-200', description: '天然降膽固醇，維護心血管健康' }
                ],
                protein: [
                    { name: '乳清蛋白', brand: 'Optimum Nutrition', rating: '4.6/5', price: 'HK$400-500', description: '易吸收蛋白質，維持肌肉量，適合長者' },
                    { name: '膠原蛋白', brand: 'DHC', rating: '4.3/5', price: 'HK$180-250', description: '維持皮膚彈性，保護關節軟骨' },
                    { name: '植物蛋白', brand: 'Garden of Life', rating: '4.4/5', price: 'HK$350-450', description: '植物性蛋白質，易消化，適合素食者' },
                    { name: '胺基酸複合物', brand: 'NOW Foods', rating: '4.2/5', price: 'HK$200-300', description: '全面胺基酸補充，促進蛋白質合成' }
                ],
                joint: [
                    { name: '葡萄糖胺', brand: 'Move Free', rating: '4.4/5', price: 'HK$250-350', description: '維護關節軟骨，減緩關節退化' },
                    { name: '軟骨素', brand: 'Schiff', rating: '4.3/5', price: 'HK$300-400', description: '保護關節，減少關節疼痛和僵硬' },
                    { name: 'MSM 有機硫', brand: 'Puritan\'s Pride', rating: '4.2/5', price: 'HK$180-250', description: '天然抗炎，改善關節靈活性' },
                    { name: '薑黃素', brand: 'Swanson', rating: '4.5/5', price: 'HK$150-220', description: '強效抗炎，緩解關節不適' }
                ],
                immunity: [
                    { name: '維生素 C', brand: 'Emergen-C', rating: '4.4/5', price: 'HK$120-180', description: '增強免疫力，抗氧化，促進鐵質吸收' },
                    { name: '維生素 D3', brand: 'Nature Made', rating: '4.5/5', price: 'HK$100-150', description: '強化骨骼，調節免疫系統' },
                    { name: '益生菌', brand: 'Culturelle', rating: '4.3/5', price: 'HK$280-350', description: '改善腸道健康，增強免疫力' },
                    { name: '蜂膠', brand: '澳洲 Comvita', rating: '4.2/5', price: 'HK$200-280', description: '天然抗菌，提升免疫防護' }
                ]
            },
            'en': {
                cardiovascular: [
                    { name: 'Deep Sea Fish Oil', brand: 'Nordic Naturals', rating: '4.5/5', price: 'HK$280-350', description: 'Rich in Omega-3, supports cardiovascular health and reduces blood lipids' },
                    { name: 'Coenzyme Q10', brand: 'Life Extension', rating: '4.4/5', price: 'HK$320-400', description: 'Protects heart muscle, improves cardiac function, antioxidant properties' },
                    { name: 'Nattokinase', brand: 'Japan Mikuni', rating: '4.3/5', price: 'HK$200-280', description: 'Helps blood circulation, prevents thrombosis formation' },
                    { name: 'Red Yeast Rice', brand: 'Uni-President Bio', rating: '4.2/5', price: 'HK$150-200', description: 'Natural cholesterol reduction, maintains cardiovascular health' }
                ],
                protein: [
                    { name: 'Whey Protein', brand: 'Optimum Nutrition', rating: '4.6/5', price: 'HK$400-500', description: 'Easily absorbed protein, maintains muscle mass, suitable for seniors' },
                    { name: 'Collagen', brand: 'DHC', rating: '4.3/5', price: 'HK$180-250', description: 'Maintains skin elasticity, protects joint cartilage' },
                    { name: 'Plant Protein', brand: 'Garden of Life', rating: '4.4/5', price: 'HK$350-450', description: 'Plant-based protein, easy to digest, suitable for vegetarians' },
                    { name: 'Amino Acid Complex', brand: 'NOW Foods', rating: '4.2/5', price: 'HK$200-300', description: 'Comprehensive amino acid supplement, promotes protein synthesis' }
                ],
                joint: [
                    { name: 'Glucosamine', brand: 'Move Free', rating: '4.4/5', price: 'HK$250-350', description: 'Maintains joint cartilage, slows joint degeneration' },
                    { name: 'Chondroitin', brand: 'Schiff', rating: '4.3/5', price: 'HK$300-400', description: 'Protects joints, reduces joint pain and stiffness' },
                    { name: 'MSM Organic Sulfur', brand: 'Puritan\'s Pride', rating: '4.2/5', price: 'HK$180-250', description: 'Natural anti-inflammatory, improves joint flexibility' },
                    { name: 'Turmeric Curcumin', brand: 'Swanson', rating: '4.5/5', price: 'HK$150-220', description: 'Powerful anti-inflammatory, relieves joint discomfort' }
                ],
                immunity: [
                    { name: 'Vitamin C', brand: 'Emergen-C', rating: '4.4/5', price: 'HK$120-180', description: 'Boosts immunity, antioxidant, promotes iron absorption' },
                    { name: 'Vitamin D3', brand: 'Nature Made', rating: '4.5/5', price: 'HK$100-150', description: 'Strengthens bones, regulates immune system' },
                    { name: 'Probiotics', brand: 'Culturelle', rating: '4.3/5', price: 'HK$280-350', description: 'Improves gut health, enhances immunity' },
                    { name: 'Propolis', brand: 'Australia Comvita', rating: '4.2/5', price: 'HK$200-280', description: 'Natural antibacterial, boosts immune defense' }
                ]
            }
        };

        // Wrap supplement functionality in DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            const categoryButtons = document.querySelectorAll('.category-btn');
            const supplementList = document.getElementById('supplementList');

            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const category = button.getAttribute('data-category');
                    
                    // 移除所有活跃状态
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // 显示对应分类的保健品，使用当前语言的数据
                    const supplements = supplementData[currentLanguage] ? supplementData[currentLanguage][category] || [] : [];
                    supplementList.innerHTML = supplements.map(supplement => `
                        <div class="recommendation-card">
                            <h4>${supplement.name}</h4>
                            <p><strong>${translations[currentLanguage].brandLabel}</strong>${supplement.brand}</p>
                            <p class="rating"><strong>${translations[currentLanguage].ratingLabel}</strong>${supplement.rating}</p>
                            <p><strong>${translations[currentLanguage].priceLabel}</strong>${supplement.price}</p>
                            <p><strong>${translations[currentLanguage].effectLabel}</strong>${supplement.description}</p>
                        </div>
                    `).join('');
                });
            });

            // 默认显示心血管保健品
            const cardiovascularBtn = document.getElementById('cardiovascularBtn');
            if (cardiovascularBtn) {
                cardiovascularBtn.click();
            }
        });

        // --- 旧的健身房事件监听器（已被新的地理位置功能替代） ---
        // 这个事件监听器在下面的地理位置功能中被重新绑定

        // --- 地理位置餐厅推荐功能 ---
        // 扩展餐厅数据，包含地理位置信息和多语言支持
        const locationBasedRestaurantData = {
            'zh-CN': {
                regions: {
                    // 香港地区 (经度：113.8-114.5, 纬度：22.1-22.6)
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        restaurants: [
                            { name: '大家乐', type: '港式茶餐厅', rating: '4.2/5', address: '全港多个分店', description: '提供清淡粥品、蒸蛋、白切鸡等适合长者的健康选择' },
                            { name: '一粥面', type: '粥面专门店', rating: '4.3/5', address: '全港多个分店', description: '专营各式养生粥品，少油少盐，营养丰富' },
                            { name: '美心餐厅', type: '港式餐厅', rating: '4.1/5', address: '全港多个分店', description: '提供蒸鱼、白灼菜心等清淡菜式' },
                            { name: '翠华餐厅', type: '茶餐厅', rating: '4.0/5', address: '全港多个分店', description: '有清汤面条、蒸蛋等适合长者的选择' },
                            { name: '稻香', type: '中式餐厅', rating: '4.4/5', address: '全港多个分店', description: '提供清蒸点心、白粥等健康选择' },
                            { name: '添好运', type: '港式点心', rating: '4.2/5', address: '全港多个分店', description: '米其林推荐，提供清淡点心选择' }
                        ]
                    },
                    // 台北地区 (经度：121.4-121.7, 纬度：24.9-25.3)
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        restaurants: [
                            { name: '胡须张', type: '台式小吃', rating: '4.1/5', address: '台北多个分店', description: '卤肉饭口味清淡，适合长者' },
                            { name: '永和豆浆', type: '早餐店', rating: '4.0/5', address: '台北多个分店', description: '豆浆、稀饭等清淡营养早餐' },
                            { name: '鼎泰丰', type: '小笼包', rating: '4.5/5', address: '信义区、中山区等', description: '清汤小笼包，制作精细' },
                            { name: '欣叶餐厅', type: '台菜', rating: '4.3/5', address: '台北多个分店', description: '提供清蒸鱼、烫青菜等健康台菜' }
                        ]
                    },
                    // 上海地区 (经度：121.0-121.9, 纬度：30.7-31.4)
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        restaurants: [
                            { name: '南翔馒头店', type: '上海小吃', rating: '4.2/5', address: '豫园、淮海路等', description: '清汤小笼包，口味清淡' },
                            { name: '老盛昌', type: '汤包店', rating: '4.1/5', address: '上海多个分店', description: '各式清汤汤包，营养丰富' },
                            { name: '新雅粤菜馆', type: '粤菜', rating: '4.4/5', address: '南京东路', description: '清蒸鱼、白切鸡等清淡粤菜' },
                            { name: '功德林', type: '素食', rating: '4.0/5', address: '南京西路', description: '素食餐厅，清淡健康' }
                        ]
                    }
                },
                // 通用推荐（当无法确定地理位置时使用）
                general: [
                    { name: '健康餐厅', type: '健康料理', rating: '4.3/5', address: '各地分店', description: '提供低盐、低油、高纤维的健康餐点' },
                    { name: '养生粥品店', type: '粥品专门', rating: '4.2/5', address: '社区分店', description: '各式养生粥品，易消化，营养丰富' },
                    { name: '清淡家常菜', type: '家常菜', rating: '4.1/5', address: '住宅区', description: '提供蒸煮类菜品，口味清淡适合长者' },
                    { name: '素食餐厅', type: '素食', rating: '4.0/5', address: '市中心', description: '纯素食餐点，健康清淡，营养均衡' }
                ]
            },
            'zh-TW': {
                regions: {
                    // 香港地区 (经度：113.8-114.5, 纬度：22.1-22.6)
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        restaurants: [
                            { name: '大家樂', type: '港式茶餐廳', rating: '4.2/5', address: '全港多個分店', description: '提供清淡粥品、蒸蛋、白切雞等適合長者的健康選擇' },
                            { name: '一粥麵', type: '粥麵專門店', rating: '4.3/5', address: '全港多個分店', description: '專營各式養生粥品，少油少鹽，營養豐富' },
                            { name: '美心餐廳', type: '港式餐廳', rating: '4.1/5', address: '全港多個分店', description: '提供蒸魚、白灼菜心等清淡菜式' },
                            { name: '翠華餐廳', type: '茶餐廳', rating: '4.0/5', address: '全港多個分店', description: '有清湯麵條、蒸蛋等適合長者的選擇' },
                            { name: '稻香', type: '中式餐廳', rating: '4.4/5', address: '全港多個分店', description: '提供清蒸點心、白粥等健康選擇' },
                            { name: '添好運', type: '港式點心', rating: '4.2/5', address: '全港多個分店', description: '米其林推薦，提供清淡點心選擇' }
                        ]
                    },
                    // 台北地区 (经度：121.4-121.7, 纬度：24.9-25.3)
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        restaurants: [
                            { name: '鬍鬚張', type: '台式小吃', rating: '4.1/5', address: '台北多個分店', description: '滷肉飯口味清淡，適合長者' },
                            { name: '永和豆漿', type: '早餐店', rating: '4.0/5', address: '台北多個分店', description: '豆漿、稀飯等清淡營養早餐' },
                            { name: '鼎泰豐', type: '小籠包', rating: '4.5/5', address: '信義區、中山區等', description: '清湯小籠包，製作精細' },
                            { name: '欣葉餐廳', type: '台菜', rating: '4.3/5', address: '台北多個分店', description: '提供清蒸魚、燙青菜等健康台菜' }
                        ]
                    },
                    // 上海地区 (经度：121.0-121.9, 纬度：30.7-31.4)
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        restaurants: [
                            { name: '南翔饅頭店', type: '上海小吃', rating: '4.2/5', address: '豫園、淮海路等', description: '清湯小籠包，口味清淡' },
                            { name: '老盛昌', type: '湯包店', rating: '4.1/5', address: '上海多個分店', description: '各式清湯湯包，營養豐富' },
                            { name: '新雅粤菜館', type: '粵菜', rating: '4.4/5', address: '南京東路', description: '清蒸魚、白切雞等清淡粵菜' },
                            { name: '功德林', type: '素食', rating: '4.0/5', address: '南京西路', description: '素食餐廳，清淡健康' }
                        ]
                    }
                },
                // 通用推荐（当无法确定地理位置时使用）
                general: [
                    { name: '健康餐廳', type: '健康料理', rating: '4.3/5', address: '各地分店', description: '提供低鹽、低油、高纖維的健康餐點' },
                    { name: '養生粥品店', type: '粥品專門', rating: '4.2/5', address: '社區分店', description: '各式養生粥品，易消化，營養豐富' },
                    { name: '清淡家常菜', type: '家常菜', rating: '4.1/5', address: '住宅區', description: '提供蒸煮類菜品，口味清淡適合長者' },
                    { name: '素食餐廳', type: '素食', rating: '4.0/5', address: '市中心', description: '純素食餐點，健康清淡，營養均衡' }
                ]
            },
            'zh-TW': {
                regions: {
                    // 香港地区 (经度：113.8-114.5, 纬度：22.1-22.6)
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        restaurants: [
                            { name: '大家樂', type: '港式茶餐廳', rating: '4.2/5', address: '全港多個分店', description: '提供清淡粥品、蒸蛋、白切雞等適合長者的健康選擇' },
                            { name: '一粥麵', type: '粥麵專門店', rating: '4.3/5', address: '全港多個分店', description: '專營各式養生粥品，少油少鹽，營養豐富' },
                            { name: '美心餐廳', type: '港式餐廳', rating: '4.1/5', address: '全港多個分店', description: '提供蒸魚、白灼菜心等清淡菜式' },
                            { name: '翠華餐廳', type: '茶餐廳', rating: '4.0/5', address: '全港多個分店', description: '有清湯麵條、蒸蛋等適合長者的選擇' },
                            { name: '稻香', type: '中式餐廳', rating: '4.4/5', address: '全港多個分店', description: '提供清蒸點心、白粥等健康選擇' },
                            { name: '添好運', type: '港式點心', rating: '4.2/5', address: '全港多個分店', description: '米其林推薦，提供清淡點心選擇' }
                        ]
                    },
                    // 台北地区 (经度：121.4-121.7, 纬度：24.9-25.3)
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        restaurants: [
                            { name: '鬍鬚張', type: '台式小吃', rating: '4.1/5', address: '台北多個分店', description: '滷肉飯口味清淡，適合長者' },
                            { name: '永和豆漿', type: '早餐店', rating: '4.0/5', address: '台北多個分店', description: '豆漿、稀飯等清淡營養早餐' },
                            { name: '鼎泰豐', type: '小籠包', rating: '4.5/5', address: '信義區、中山區等', description: '清湯小籠包，製作精細' },
                            { name: '欣葉餐廳', type: '台菜', rating: '4.3/5', address: '台北多個分店', description: '提供清蒸魚、燙青菜等健康台菜' }
                        ]
                    },
                    // 上海地区 (经度：121.0-121.9, 纬度：30.7-31.4)
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        restaurants: [
                            { name: '南翔饅頭店', type: '上海小吃', rating: '4.2/5', address: '豫園、淮海路等', description: '清湯小籠包，口味清淡' },
                            { name: '老盛昌', type: '湯包店', rating: '4.1/5', address: '上海多個分店', description: '各式清湯湯包，營養豐富' },
                            { name: '新雅粤菜館', type: '粵菜', rating: '4.4/5', address: '南京東路', description: '清蒸魚、白切雞等清淡粵菜' },
                            { name: '功德林', type: '素食', rating: '4.0/5', address: '南京西路', description: '素食餐廳，清淡健康' }
                        ]
                    }
                },
                // 通用推荐（当无法确定地理位置时使用）
                general: [
                    { name: '健康餐廳', type: '健康料理', rating: '4.3/5', address: '各地分店', description: '提供低鹽、低油、高纖維的健康餐點' },
                    { name: '養生粥品店', type: '粥品專門', rating: '4.2/5', address: '社區分店', description: '各式養生粥品，易消化，營養豐富' },
                    { name: '清淡家常菜', type: '家常菜', rating: '4.1/5', address: '住宅區', description: '提供蒸煮類菜品，口味清淡適合長者' },
                    { name: '素食餐廳', type: '素食', rating: '4.0/5', address: '市中心', description: '純素食餐點，健康清淡，營養均衡' }
                ]
            },
            'zh-TW': {
                regions: {
                    // 香港地区 (经度：113.8-114.5, 纬度：22.1-22.6)
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        restaurants: [
                            { name: '大家樂', type: '港式茶餐廳', rating: '4.2/5', address: '全港多個分店', description: '提供清淡粥品、蒸蛋、白切雞等適合長者的健康選擇' },
                            { name: '一粥麵', type: '粥麵專門店', rating: '4.3/5', address: '全港多個分店', description: '專營各式養生粥品，少油少鹽，營養豐富' },
                            { name: '美心餐廳', type: '港式餐廳', rating: '4.1/5', address: '全港多個分店', description: '提供蒸魚、白灼菜心等清淡菜式' },
                            { name: '翠華餐廳', type: '茶餐廳', rating: '4.0/5', address: '全港多個分店', description: '有清湯麵條、蒸蛋等適合長者的選擇' },
                            { name: '稻香', type: '中式餐廳', rating: '4.4/5', address: '全港多個分店', description: '提供清蒸點心、白粥等健康選擇' },
                            { name: '添好運', type: '港式點心', rating: '4.2/5', address: '全港多個分店', description: '米其林推薦，提供清淡點心選擇' }
                        ]
                    },
                    // 台北地区 (经度：121.4-121.7, 纬度：24.9-25.3)
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        restaurants: [
                            { name: '鬍鬚張', type: '台式小吃', rating: '4.1/5', address: '台北多個分店', description: '滷肉飯口味清淡，適合長者' },
                            { name: '永和豆漿', type: '早餐店', rating: '4.0/5', address: '台北多個分店', description: '豆漿、稀飯等清淡營養早餐' },
                            { name: '鼎泰豐', type: '小籠包', rating: '4.5/5', address: '信義區、中山區等', description: '清湯小籠包，製作精細' },
                            { name: '欣葉餐廳', type: '台菜', rating: '4.3/5', address: '台北多個分店', description: '提供清蒸魚、燙青菜等健康台菜' }
                        ]
                    },
                    // 上海地区 (经度：121.0-121.9, 纬度：30.7-31.4)
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        restaurants: [
                            { name: '南翔饅頭店', type: '上海小吃', rating: '4.2/5', address: '豫園、淮海路等', description: '清湯小籠包，口味清淡' },
                            { name: '老盛昌', type: '湯包店', rating: '4.1/5', address: '上海多個分店', description: '各式清湯湯包，營養豐富' },
                            { name: '新雅粤菜館', type: '粵菜', rating: '4.4/5', address: '南京東路', description: '清蒸魚、白切雞等清淡粵菜' },
                            { name: '功德林', type: '素食', rating: '4.0/5', address: '南京西路', description: '素食餐廳，清淡健康' }
                        ]
                    }
                },
                // 通用推荐（当无法确定地理位置时使用）
                general: [
                    { name: '健康餐廳', type: '健康料理', rating: '4.3/5', address: '各地分店', description: '提供低鹽、低油、高纖維的健康餐點' },
                    { name: '養生粥品店', type: '粥品專門', rating: '4.2/5', address: '社區分店', description: '各式養生粥品，易消化，營養豐富' },
                    { name: '清淡家常菜', type: '家常菜', rating: '4.1/5', address: '住宅區', description: '提供蒸煮類菜品，口味清淡適合長者' },
                    { name: '素食餐廳', type: '素食', rating: '4.0/5', address: '市中心', description: '純素食餐點，健康清淡，營養均衡' }
                ]
            },
            'zh-TW': {
                regions: {
                    // 香港地区 (经度：113.8-114.5, 纬度：22.1-22.6)
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        restaurants: [
                            { name: '大家樂', type: '港式茶餐廳', rating: '4.2/5', address: '全港多個分店', description: '提供清淡粥品、蒸蛋、白切雞等適合長者的健康選擇' },
                            { name: '一粥麵', type: '粥麵專門店', rating: '4.3/5', address: '全港多個分店', description: '專營各式養生粥品，少油少鹽，營養豐富' },
                            { name: '美心餐廳', type: '港式餐廳', rating: '4.1/5', address: '全港多個分店', description: '提供蒸魚、白灼菜心等清淡菜式' },
                            { name: '翠華餐廳', type: '茶餐廳', rating: '4.0/5', address: '全港多個分店', description: '有清湯麵條、蒸蛋等適合長者的選擇' },
                            { name: '稻香', type: '中式餐廳', rating: '4.4/5', address: '全港多個分店', description: '提供清蒸點心、白粥等健康選擇' },
                            { name: '添好運', type: '港式點心', rating: '4.2/5', address: '全港多個分店', description: '米其林推薦，提供清淡點心選擇' }
                        ]
                    },
                    // 台北地区 (经度：121.4-121.7, 纬度：24.9-25.3)
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        restaurants: [
                            { name: '鬍鬚張', type: '台式小吃', rating: '4.1/5', address: '台北多個分店', description: '滷肉飯口味清淡，適合長者' },
                            { name: '永和豆漿', type: '早餐店', rating: '4.0/5', address: '台北多個分店', description: '豆漿、稀飯等清淡營養早餐' },
                            { name: '鼎泰豐', type: '小籠包', rating: '4.5/5', address: '信義區、中山區等', description: '清湯小籠包，製作精細' },
                            { name: '欣葉餐廳', type: '台菜', rating: '4.3/5', address: '台北多個分店', description: '提供清蒸魚、燙青菜等健康台菜' }
                        ]
                    },
                    // 上海地区 (经度：121.0-121.9, 纬度：30.7-31.4)
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        restaurants: [
                            { name: '南翔饅頭店', type: '上海小吃', rating: '4.2/5', address: '豫園、淮海路等', description: '清湯小籠包，口味清淡' },
                            { name: '老盛昌', type: '湯包店', rating: '4.1/5', address: '上海多個分店', description: '各式清湯湯包，營養豐富' },
                            { name: '新雅粤菜館', type: '粵菜', rating: '4.4/5', address: '南京東路', description: '清蒸魚、白切雞等清淡粵菜' },
                            { name: '功德林', type: '素食', rating: '4.0/5', address: '南京西路', description: '素食餐廳，清淡健康' }
                        ]
                    }
                },
                // 通用推荐（当无法确定地理位置时使用）
                general: [
                    { name: '健康餐廳', type: '健康料理', rating: '4.3/5', address: '各地分店', description: '提供低鹽、低油、高纖維的健康餐點' },
                    { name: '養生粥品店', type: '粥品專門', rating: '4.2/5', address: '社區分店', description: '各式養生粥品，易消化，營養豐富' },
                    { name: '清淡家常菜', type: '家常菜', rating: '4.1/5', address: '住宅區', description: '提供蒸煮類菜品，口味清淡適合長者' },
                    { name: '素食餐廳', type: '素食', rating: '4.0/5', address: '市中心', description: '純素食餐點，健康清淡，營養均衡' }
                ]
            },
            'en': {
                regions: {
                    // Hong Kong region (longitude: 113.8-114.5, latitude: 22.1-22.6)
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        restaurants: [
                            { name: 'Cafe de Coral', type: 'Hong Kong Style Tea Restaurant', rating: '4.2/5', address: 'Multiple locations in Hong Kong', description: 'Offers light congee, steamed eggs, and plain chicken suitable for elderly' },
                            { name: 'Congee & Noodle Shop', type: 'Congee & Noodle Specialist', rating: '4.3/5', address: 'Multiple locations in Hong Kong', description: 'Specializes in various health congees, low oil and salt, nutritious' },
                            { name: 'Maxims Restaurant', type: 'Hong Kong Style Restaurant', rating: '4.1/5', address: 'Multiple locations in Hong Kong', description: 'Offers steamed fish, blanched vegetables and other light dishes' },
                            { name: 'Tsui Wah Restaurant', type: 'Tea Restaurant', rating: '4.0/5', address: 'Multiple locations in Hong Kong', description: 'Has clear soup noodles, steamed eggs suitable for elderly' },
                            { name: 'Dao Xiang', type: 'Chinese Restaurant', rating: '4.4/5', address: 'Multiple locations in Hong Kong', description: 'Offers steamed dim sum, plain congee and other healthy choices' },
                            { name: 'Tim Ho Wan', type: 'Hong Kong Dim Sum', rating: '4.2/5', address: 'Multiple locations in Hong Kong', description: 'Michelin recommended, offers light dim sum choices' }
                        ]
                    },
                    // Taipei region (longitude: 121.4-121.7, latitude: 24.9-25.3)
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        restaurants: [
                            { name: 'Formosa Chang', type: 'Taiwanese Snacks', rating: '4.1/5', address: 'Multiple locations in Taipei', description: 'Light flavored braised pork rice, suitable for elderly' },
                            { name: 'Yonghe Soy Milk', type: 'Breakfast Shop', rating: '4.0/5', address: 'Multiple locations in Taipei', description: 'Soy milk, rice porridge and other light nutritious breakfast' },
                            { name: 'Din Tai Fung', type: 'Xiaolongbao', rating: '4.5/5', address: 'Xinyi District, Zhongshan District etc.', description: 'Clear soup xiaolongbao, finely made' },
                            { name: 'Shin Yeh Restaurant', type: 'Taiwanese Cuisine', rating: '4.3/5', address: 'Multiple locations in Taipei', description: 'Offers steamed fish, blanched vegetables and other healthy Taiwanese dishes' }
                        ]
                    },
                    // Shanghai region (longitude: 121.0-121.9, latitude: 30.7-31.4)
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        restaurants: [
                            { name: 'Nanxiang Steamed Bun Restaurant', type: 'Shanghai Snacks', rating: '4.2/5', address: 'Yu Garden, Huaihai Road etc.', description: 'Clear soup xiaolongbao, light flavor' },
                            { name: 'Lao Sheng Chang', type: 'Soup Dumpling Shop', rating: '4.1/5', address: 'Multiple locations in Shanghai', description: 'Various clear soup dumplings, nutritious' },
                            { name: 'Xin Ya Cantonese Restaurant', type: 'Cantonese Cuisine', rating: '4.4/5', address: 'Nanjing East Road', description: 'Steamed fish, plain chicken and other light Cantonese dishes' },
                            { name: 'Gong De Lin', type: 'Vegetarian', rating: '4.0/5', address: 'Nanjing West Road', description: 'Vegetarian restaurant, light and healthy' }
                        ]
                    }
                },
                // General recommendations (used when geographical location cannot be determined)
                general: [
                    { name: 'Healthy Restaurant', type: 'Healthy Cuisine', rating: '4.3/5', address: 'Various locations', description: 'Provides low-salt, low-oil, high-fiber healthy meals' },
                    { name: 'Health Congee Shop', type: 'Congee Specialist', rating: '4.2/5', address: 'Community stores', description: 'Various health congees, easy to digest, nutritious' },
                    { name: 'Light Home Cooking', type: 'Home-style Dishes', rating: '4.1/5', address: 'Residential areas', description: 'Provides steamed dishes, light flavor suitable for elderly' },
                    { name: 'Vegetarian Restaurant', type: 'Vegetarian', rating: '4.0/5', address: 'City center', description: 'Pure vegetarian meals, healthy and light, nutritionally balanced' }
                ]
            }
        };

        // 地理位置健身房数据
        const locationBasedGymData = {
            'zh-CN': {
                regions: {
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        gyms: [
                            { name: 'Pure Fitness', type: '连锁健身房', rating: '4.3/5', address: '中环、铜锣湾等', description: '设有长者专属时段，提供水中运动、太极等适合长者的课程' },
                            { name: 'Fitness First', type: '国际连锁', rating: '4.2/5', address: '全港多个分店', description: '有专业教练指导，提供低强度运动课程' },
                            { name: '康文署体育馆', type: '公共设施', rating: '4.0/5', address: '各区体育馆', description: '收费便宜，设有长者健身器材和太极班' },
                            { name: 'YMCA', type: '基督教青年会', rating: '4.1/5', address: '中环、尖沙咀等', description: '专为长者设计的运动课程，包括水疗和轻量训练' }
                        ]
                    },
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        gyms: [
                            { name: 'World Gym', type: '连锁健身房', rating: '4.2/5', address: '台北多个分店', description: '设有银发族专区，提供适合长者的运动器材' },
                            { name: '健身工厂', type: '本土连锁', rating: '4.1/5', address: '台北多个分店', description: '价格亲民，有长者友善的运动课程' },
                            { name: '台北市运动中心', type: '公共设施', rating: '4.0/5', address: '各区运动中心', description: '公营设施，提供长者专属运动时段' },
                            { name: 'Curves', type: '女性专用', rating: '4.3/5', address: '台北多个分店', description: '30 分钟循环运动，适合长者女性' }
                        ]
                    },
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        gyms: [
                            { name: '威尔士健身', type: '连锁健身房', rating: '4.2/5', address: '上海多个分店', description: '设有长者运动课程，专业教练指导' },
                            { name: '一兆韦德', type: '本土连锁', rating: '4.1/5', address: '上海多个分店', description: '提供太极、瑜伽等适合长者的课程' },
                            { name: '上海市民健身中心', type: '公共设施', rating: '4.0/5', address: '各区健身中心', description: '政府运营，收费低廉，设施完善' },
                            { name: '舒适堡', type: '高端健身', rating: '4.4/5', address: '浦东、徐汇等', description: '环境舒适，有专门的长者运动区域' }
                        ]
                    }
                },
                general: [
                    { name: '社区健身中心', type: '公共设施', rating: '4.1/5', address: '各社区', description: '政府或社区运营，收费便宜，设施适合长者' },
                    { name: '长者运动中心', type: '专门机构', rating: '4.2/5', address: '市中心', description: '专为长者设计的运动设施和课程' },
                    { name: '水中健身馆', type: '水疗中心', rating: '4.0/5', address: '健康中心', description: '提供水中运动课程，对关节友好' },
                    { name: '太极养生馆', type: '传统运动', rating: '4.3/5', address: '公园附近', description: '教授太极、气功等适合长者的运动' }
                ]
            },
            'zh-TW': {
                regions: {
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        gyms: [
                            { name: 'Pure Fitness', type: '連鎖健身房', rating: '4.3/5', address: '中環、銅鑼灣等', description: '設有長者專屬時段，提供水中運動、太極等適合長者的課程' },
                            { name: 'Fitness First', type: '國際連鎖', rating: '4.2/5', address: '全港多個分店', description: '有專業教練指導，提供低強度運動課程' },
                            { name: '康文署體育館', type: '公共設施', rating: '4.0/5', address: '各區體育館', description: '收費便宜，設有長者健身器材和太極班' },
                            { name: 'YMCA', type: '基督教青年會', rating: '4.1/5', address: '中環、尖沙咀等', description: '專為長者設計的運動課程，包括水療和輕量訓練' }
                        ]
                    },
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        gyms: [
                            { name: 'World Gym', type: '連鎖健身房', rating: '4.2/5', address: '台北多個分店', description: '設有銀髮族專區，提供適合長者的運動器材' },
                            { name: '健身工廠', type: '本土連鎖', rating: '4.1/5', address: '台北多個分店', description: '價格親民，有長者友善的運動課程' },
                            { name: '台北市運動中心', type: '公共設施', rating: '4.0/5', address: '各區運動中心', description: '公營設施，提供長者專屬運動時段' },
                            { name: 'Curves', type: '女性專用', rating: '4.3/5', address: '台北多個分店', description: '30 分鐘循環運動，適合長者女性' }
                        ]
                    },
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        gyms: [
                            { name: '威爾士健身', type: '連鎖健身房', rating: '4.2/5', address: '上海多個分店', description: '設有長者運動課程，專業教練指導' },
                            { name: '一兆韋德', type: '本土連鎖', rating: '4.1/5', address: '上海多個分店', description: '提供太極、瑜伽等適合長者的課程' },
                            { name: '上海市民健身中心', type: '公共設施', rating: '4.0/5', address: '各區健身中心', description: '政府運營，收費低廉，設施完善' },
                            { name: '舒適堡', type: '高端健身', rating: '4.4/5', address: '浦東、徐匯等', description: '環境舒適，有專門的長者運動區域' }
                        ]
                    }
                },
                general: [
                    { name: '社區健身中心', type: '公共設施', rating: '4.1/5', address: '各社區', description: '政府或社區運營，收費便宜，設施適合長者' },
                    { name: '長者運動中心', type: '專門機構', rating: '4.2/5', address: '市中心', description: '專為長者設計的運動設施和課程' },
                    { name: '水中健身館', type: '水療中心', rating: '4.0/5', address: '健康中心', description: '提供水中運動課程，對關節友好' },
                    { name: '太極養生館', type: '傳統運動', rating: '4.3/5', address: '公園附近', description: '教授太極、氣功等適合長者的運動' }
                ]
            },
            'en': {
                regions: {
                    hongkong: {
                        bounds: { minLat: 22.1, maxLat: 22.6, minLng: 113.8, maxLng: 114.5 },
                        gyms: [
                            { name: 'Pure Fitness', type: 'Chain Gym', rating: '4.3/5', address: 'Central, Causeway Bay etc.', description: 'Has dedicated senior hours, offers water exercises, Tai Chi and other programs suitable for elderly' },
                            { name: 'Fitness First', type: 'International Chain', rating: '4.2/5', address: 'Multiple locations in Hong Kong', description: 'Has professional trainer guidance, offers low-intensity exercise programs' },
                            { name: 'LCSD Sports Center', type: 'Public Facility', rating: '4.0/5', address: 'Sports centers in various districts', description: 'Affordable fees, has senior fitness equipment and Tai Chi classes' },
                            { name: 'YMCA', type: 'YMCA', rating: '4.1/5', address: 'Central, Tsim Sha Tsui etc.', description: 'Exercise programs specially designed for seniors, including hydrotherapy and light training' }
                        ]
                    },
                    taipei: {
                        bounds: { minLat: 24.9, maxLat: 25.3, minLng: 121.4, maxLng: 121.7 },
                        gyms: [
                            { name: 'World Gym', type: 'Chain Gym', rating: '4.2/5', address: 'Multiple locations in Taipei', description: 'Has senior-specific areas, provides exercise equipment suitable for elderly' },
                            { name: 'Fitness Factory', type: 'Local Chain', rating: '4.1/5', address: 'Multiple locations in Taipei', description: 'Affordable prices, has senior-friendly exercise programs' },
                            { name: 'Taipei Sports Center', type: 'Public Facility', rating: '4.0/5', address: 'Sports centers in various districts', description: 'Public facility, provides dedicated exercise hours for seniors' },
                            { name: 'Curves', type: 'Women-only', rating: '4.3/5', address: 'Multiple locations in Taipei', description: '30-minute circuit training, suitable for senior women' }
                        ]
                    },
                    shanghai: {
                        bounds: { minLat: 30.7, maxLat: 31.4, minLng: 121.0, maxLng: 121.9 },
                        gyms: [
                            { name: 'Will\'s Fitness', type: 'Chain Gym', rating: '4.2/5', address: 'Multiple locations in Shanghai', description: 'Has senior exercise programs with professional trainer guidance' },
                            { name: 'Tera Wellness', type: 'Local Chain', rating: '4.1/5', address: 'Multiple locations in Shanghai', description: 'Offers Tai Chi, yoga and other programs suitable for seniors' },
                            { name: 'Shanghai Citizens Fitness Center', type: 'Public Facility', rating: '4.0/5', address: 'Fitness centers in various districts', description: 'Government operated, low fees, complete facilities' },
                            { name: 'Comfort Gym', type: 'Premium Fitness', rating: '4.4/5', address: 'Pudong, Xuhui etc.', description: 'Comfortable environment, has dedicated senior exercise areas' }
                        ]
                    }
                },
                general: [
                    { name: 'Community Fitness Center', type: 'Public Facility', rating: '4.1/5', address: 'Various communities', description: 'Government or community operated, affordable fees, facilities suitable for seniors' },
                    { name: 'Senior Exercise Center', type: 'Specialized Institution', rating: '4.2/5', address: 'City center', description: 'Exercise facilities and programs specially designed for seniors' },
                    { name: 'Aquatic Fitness Center', type: 'Hydrotherapy Center', rating: '4.0/5', address: 'Health center', description: 'Provides water exercise programs, joint-friendly' },
                    { name: 'Tai Chi Wellness Center', type: 'Traditional Exercise', rating: '4.3/5', address: 'Near parks', description: 'Teaches Tai Chi, Qigong and other exercises suitable for seniors' }
                ]
            }
        };

        // 根据地理坐标获取餐厅推荐
        function getRestaurantsByLocation(lat, lng) {
            const currentData = locationBasedRestaurantData[currentLanguage] || locationBasedRestaurantData['zh-CN'];
            for (const [regionName, regionData] of Object.entries(currentData.regions)) {
                const bounds = regionData.bounds;
                if (lat >= bounds.minLat && lat <= bounds.maxLat && 
                    lng >= bounds.minLng && lng <= bounds.maxLng) {
                    return regionData.restaurants;
                }
            }
            return currentData.general;
        }

        // 根据地理坐标获取健身房推荐
        function getGymsByLocation(lat, lng) {
            const currentData = locationBasedGymData[currentLanguage] || locationBasedGymData['zh-CN'];
            for (const [regionName, regionData] of Object.entries(currentData.regions)) {
                const bounds = regionData.bounds;
                if (lat >= bounds.minLat && lat <= bounds.maxLat && 
                    lng >= bounds.minLng && lng <= bounds.maxLng) {
                    return regionData.gyms;
                }
            }
            return currentData.general;
        }

        // 地理位置餐厅推荐事件处理函数
        function handleRestaurantLocation() {
            console.log('餐厅位置按钮被点击');
            const locationStatus = document.getElementById('locationStatus');
            const restaurantList = document.getElementById('restaurantList');
            
            if (!locationStatus) {
                console.error('找不到 locationStatus 元素');
                return;
            }
            
            if (!restaurantList) {
                console.error('找不到 restaurantList 元素');
                return;
            }
            
            if (!navigator.geolocation) {
                locationStatus.textContent = translations[currentLanguage].locationError;
                locationStatus.style.color = '#ef4444';
                console.log('浏览器不支持地理位置');
                return;
            }
            
            console.log('开始获取地理位置...');
            locationStatus.textContent = translations[currentLanguage].locationStatus;
            locationStatus.style.color = '#6b7280';
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    console.log('获取到位置:', lat, lng);
                    locationStatus.textContent = translations[currentLanguage].locationSuccess;
                    locationStatus.style.color = '#10b981';
                    
                    const restaurants = getRestaurantsByLocation(lat, lng);
                    console.log('找到餐厅:', restaurants.length);
                    
                    restaurantList.innerHTML = restaurants.map(restaurant => `
                        <div class="recommendation-card">
                            <h4>${restaurant.name}</h4>
                            <p><strong>${translations[currentLanguage].typeLabel}</strong>${restaurant.type}</p>
                            <p class="rating"><strong>${translations[currentLanguage].ratingLabel}</strong>${restaurant.rating}</p>
                            <p class="address"><strong>${translations[currentLanguage].addressLabel}</strong>${restaurant.address}</p>
                            <p><strong>${translations[currentLanguage].reasonLabel}</strong>${restaurant.description}</p>
                        </div>
                    `).join('');
                },
                (error) => {
                    console.error('地理位置错误:', error);
                    let errorMessage = translations[currentLanguage].locationError;
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = translations[currentLanguage].locationDenied;
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = translations[currentLanguage].locationUnavailable;
                            break;
                        case error.TIMEOUT:
                            errorMessage = translations[currentLanguage].locationTimeout;
                            break;
                    }
                    
                    locationStatus.textContent = errorMessage + ' - ' + translations[currentLanguage].noRecommendations;
                    locationStatus.style.color = '#ef4444';
                    
                    restaurantList.innerHTML = (locationBasedRestaurantData[currentLanguage] || locationBasedRestaurantData['zh-CN']).general.map(restaurant => `
                        <div class="recommendation-card">
                            <h4>${restaurant.name}</h4>
                            <p><strong>${translations[currentLanguage].typeLabel}</strong>${restaurant.type}</p>
                            <p class="rating"><strong>${translations[currentLanguage].ratingLabel}</strong>${restaurant.rating}</p>
                            <p class="address"><strong>${translations[currentLanguage].addressLabel}</strong>${restaurant.address}</p>
                            <p><strong>${translations[currentLanguage].reasonLabel}</strong>${restaurant.description}</p>
                        </div>
                    `).join('');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }

        // 地理位置健身房推荐事件处理函数
        function handleGymLocation() {
            console.log('健身房位置按钮被点击');
            const gymLocationStatus = document.getElementById('gymLocationStatus');
            const gymList = document.getElementById('gymList');
            
            if (!gymLocationStatus) {
                console.error('找不到 gymLocationStatus 元素');
                return;
            }
            
            if (!gymList) {
                console.error('找不到 gymList 元素');
                return;
            }
            
            if (!navigator.geolocation) {
                gymLocationStatus.textContent = translations[currentLanguage].gymLocationError;
                gymLocationStatus.style.color = '#ef4444';
                console.log('浏览器不支持地理位置');
                return;
            }
            
            console.log('开始获取地理位置...');
            gymLocationStatus.textContent = translations[currentLanguage].gymLocationStatus;
            gymLocationStatus.style.color = '#6b7280';
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    console.log('获取到位置:', lat, lng);
                    gymLocationStatus.textContent = translations[currentLanguage].gymLocationSuccess;
                    gymLocationStatus.style.color = '#10b981';
                    
                    const gyms = getGymsByLocation(lat, lng);
                    console.log('找到健身房:', gyms.length);
                    
                    gymList.innerHTML = gyms.map(gym => `
                        <div class="recommendation-card">
                            <h4>${gym.name}</h4>
                            <p><strong>${translations[currentLanguage].typeLabel}</strong>${gym.type}</p>
                            <p class="rating"><strong>${translations[currentLanguage].ratingLabel}</strong>${gym.rating}</p>
                            <p class="address"><strong>${translations[currentLanguage].addressLabel}</strong>${gym.address}</p>
                            <p><strong>${translations[currentLanguage].featureLabel}</strong>${gym.description}</p>
                        </div>
                    `).join('');
                },
                (error) => {
                    console.error('地理位置错误:', error);
                    let errorMessage = translations[currentLanguage].gymLocationError;
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = translations[currentLanguage].gymLocationDenied;
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = translations[currentLanguage].gymLocationUnavailable;
                            break;
                        case error.TIMEOUT:
                            errorMessage = translations[currentLanguage].gymLocationTimeout;
                            break;
                    }
                    
                    gymLocationStatus.textContent = errorMessage + ' - ' + translations[currentLanguage].noGymRecommendations;
                    gymLocationStatus.style.color = '#ef4444';
                    
                    gymList.innerHTML = (locationBasedGymData[currentLanguage] || locationBasedGymData['zh-CN']).general.map(gym => `
                        <div class="recommendation-card">
                            <h4>${gym.name}</h4>
                            <p><strong>${translations[currentLanguage].typeLabel}</strong>${gym.type}</p>
                            <p class="rating"><strong>${translations[currentLanguage].ratingLabel}</strong>${gym.rating}</p>
                            <p class="address"><strong>${translations[currentLanguage].addressLabel}</strong>${gym.address}</p>
                            <p><strong>${translations[currentLanguage].featureLabel}</strong>${gym.description}</p>
                        </div>
                    `).join('');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }

        // 绑定按钮事件（只绑定一次，避免重复）
        document.addEventListener('DOMContentLoaded', function() {
            const locationBtn = document.getElementById('getLocationBtn');
            const gymBtn = document.getElementById('getGymBtn');
            
            console.log('按钮元素检查：');
            console.log('locationBtn:', locationBtn);
            console.log('gymBtn:', gymBtn);
            
            if (locationBtn) {
                console.log('绑定餐厅位置按钮事件');
                // 移除可能存在的旧事件监听器（通过克隆和替换元素）
                const newLocationBtn = locationBtn.cloneNode(true);
                locationBtn.parentNode.replaceChild(newLocationBtn, locationBtn);
                newLocationBtn.addEventListener('click', handleRestaurantLocation);
            } else {
                console.error('找不到 getLocationBtn 元素');
            }
            
            if (gymBtn) {
                console.log('绑定健身房位置按钮事件');
                // 移除可能存在的旧事件监听器（通过克隆和替换元素）
                const newGymBtn = gymBtn.cloneNode(true);
                gymBtn.parentNode.replaceChild(newGymBtn, gymBtn);
                newGymBtn.addEventListener('click', handleGymLocation);
            } else {
                console.error('找不到 getGymBtn 元素');
            }
        });

        // 刷新当前显示的推荐内容
        function refreshCurrentRecommendations() {
            // 刷新餐厅推荐（如果有内容显示）
            const restaurantList = document.getElementById('restaurantList');
            if (restaurantList && restaurantList.innerHTML.trim() && !restaurantList.innerHTML.includes('text-center text-gray-500')) {
                // 重新生成已显示的餐厅推荐内容标签
                const restaurantCards = restaurantList.querySelectorAll('.recommendation-card');
                restaurantCards.forEach(card => {
                    const paragraphs = card.querySelectorAll('p');
                    paragraphs.forEach(p => {
                        const strongTag = p.querySelector('strong');
                        if (strongTag) {
                            const text = strongTag.textContent;
                            if (text.includes('类型') || text.includes('Type') || text.includes('類型')) {
                                strongTag.textContent = translations[currentLanguage].typeLabel;
                            } else if (text.includes('评分') || text.includes('Rating') || text.includes('評分')) {
                                strongTag.textContent = translations[currentLanguage].ratingLabel;
                            } else if (text.includes('地址') || text.includes('Address') || text.includes('地址')) {
                                strongTag.textContent = translations[currentLanguage].addressLabel;
                            } else if (text.includes('推荐理由') || text.includes('Reason') || text.includes('推薦理由')) {
                                strongTag.textContent = translations[currentLanguage].reasonLabel;
                            }
                        }
                    });
                });
            }
            
            // 刷新健身房推荐（如果有内容显示）
            const gymList = document.getElementById('gymList');
            if (gymList && gymList.innerHTML.trim() && !gymList.innerHTML.includes('text-center text-gray-500')) {
                // 重新生成已显示的健身房推荐内容标签
                const gymCards = gymList.querySelectorAll('.recommendation-card');
                gymCards.forEach(card => {
                    const paragraphs = card.querySelectorAll('p');
                    paragraphs.forEach(p => {
                        const strongTag = p.querySelector('strong');
                        if (strongTag) {
                            const text = strongTag.textContent;
                            if (text.includes('类型') || text.includes('Type') || text.includes('類型')) {
                                strongTag.textContent = translations[currentLanguage].typeLabel;
                            } else if (text.includes('评分') || text.includes('Rating') || text.includes('評分')) {
                                strongTag.textContent = translations[currentLanguage].ratingLabel;
                            } else if (text.includes('地址') || text.includes('Address') || text.includes('地址')) {
                                strongTag.textContent = translations[currentLanguage].addressLabel;
                            } else if (text.includes('特色') || text.includes('Feature') || text.includes('特色')) {
                                strongTag.textContent = translations[currentLanguage].featureLabel;
                            }
                        }
                    });
                });
            }
            
            // 刷新保健品推荐（如果有内容显示）
            const supplementList = document.getElementById('supplementList');
            if (supplementList && supplementList.innerHTML.trim()) {
                const supplementCards = supplementList.querySelectorAll('.recommendation-card');
                supplementCards.forEach(card => {
                    const paragraphs = card.querySelectorAll('p');
                    paragraphs.forEach(p => {
                        const strongTag = p.querySelector('strong');
                        if (strongTag) {
                            const text = strongTag.textContent;
                            if (text.includes('品牌') || text.includes('Brand') || text.includes('品牌')) {
                                strongTag.textContent = translations[currentLanguage].brandLabel;
                            } else if (text.includes('评分') || text.includes('Rating') || text.includes('評分')) {
                                strongTag.textContent = translations[currentLanguage].ratingLabel;
                            } else if (text.includes('价格') || text.includes('Price') || text.includes('價格')) {
                                strongTag.textContent = translations[currentLanguage].priceLabel;
                            } else if (text.includes('功效') || text.includes('Effect') || text.includes('功效')) {
                                strongTag.textContent = translations[currentLanguage].effectLabel;
                            }
                        }
                    });
                });
            }
        }
    </script>
</body>
</html>