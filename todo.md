# ä¸­è€å¹´å¹³è¡¡æ„Ÿè®­ç»ƒæ¸¸æˆ

ä¸€ä¸ªä¸“ä¸ºä¸­è€å¹´äººè®¾è®¡çš„åœ¨çº¿å¹³è¡¡æ„Ÿè®­ç»ƒæ¸¸æˆï¼Œä½¿ç”¨ MediaPipe æŠ€æœ¯è¿›è¡Œå®æ—¶å§¿æ€æ£€æµ‹ï¼Œå¸®åŠ©ç”¨æˆ·æ”¹å–„å¹³è¡¡èƒ½åŠ›ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹è‰²

- **ğŸ‘¥ ä¸“ä¸ºä¸­è€å¹´äººè®¾è®¡**ï¼šå¤§å­—ä½“ã€ç®€æ´ç•Œé¢ã€å‹å¥½é…è‰²
- **ğŸŒ å¤šè¯­è¨€æ”¯æŒ**ï¼šä¸­æ–‡/è‹±æ–‡åˆ‡æ¢
- **ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ‰‹æœºå’Œå¹³æ¿
- **ğŸ® æ™ºèƒ½éš¾åº¦è°ƒèŠ‚**ï¼šæ ¹æ®ç”¨æˆ· BMI å’Œå¹´é¾„è‡ªåŠ¨æ¨èéš¾åº¦
- **ğŸ”’ éšç§ä¿æŠ¤**ï¼šæ‰€æœ‰æ•°æ®æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ æœåŠ¡å™¨
- **âš¡ å®æ—¶åˆ†æ**ï¼šä½¿ç”¨ MediaPipe è¿›è¡Œå®æ—¶å§¿æ€æ£€æµ‹

## ğŸš€ åŠŸèƒ½ç‰¹ç‚¹

### 1. ç”¨æˆ·å‹å¥½è®¾è®¡
- è€å¹´äººå‹å¥½çš„é…è‰²æ–¹æ¡ˆï¼ˆæ·±è“è‰²ä¸»é¢˜ï¼‰
- åŠ ç²—å­—ä½“ï¼Œ18px åŸºç¡€å­—ä½“å¤§å°
- ç®€æ´ç›´è§‚çš„ç•Œé¢è®¾è®¡
- å®Œæ•´çš„å…è´£å£°æ˜

### 2. æ™ºèƒ½æ¸¸æˆç³»ç»Ÿ
- **ä¸‰ç§éš¾åº¦ç­‰çº§**ï¼šç®€å•ã€ä¸­ç­‰ã€å›°éš¾
- **æ™ºèƒ½æ¨è**ï¼šåŸºäº BMI å’Œå¹´é¾„è‡ªåŠ¨è®¾ç½®éš¾åº¦
- **å®æ—¶è¯„åˆ†**ï¼šåŸºäºå§¿æ€ç›¸ä¼¼åº¦è®¡ç®—åˆ†æ•°
- **è¥å…»å»ºè®®**ï¼šæ ¹æ®æ¸¸æˆè¡¨ç°æä¾›ä¸ªæ€§åŒ–å»ºè®®

### 3. å…ˆè¿›æŠ€æœ¯
- **MediaPipe å§¿æ€æ£€æµ‹**ï¼šå®æ—¶åˆ†æç”¨æˆ·åŠ¨ä½œ
- **è§†é¢‘å¯¹æ¯”åˆ†æ**ï¼šä¸æ ‡å‡†åŠ¨ä½œè¿›è¡Œå®æ—¶å¯¹æ¯”
- **ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•**ï¼šç²¾ç¡®è®¡ç®—åŠ¨ä½œå‡†ç¡®æ€§
- **Canvas å¯è§†åŒ–**ï¼šå®æ—¶æ˜¾ç¤ºéª¨éª¼ç‚¹å’Œè¿æ¥çº¿

## ğŸ“‹ ä½¿ç”¨æµç¨‹

1. **å…è´£å£°æ˜**ï¼šé˜…è¯»å¹¶åŒæ„ä½¿ç”¨æ¡æ¬¾
2. **ä¿¡æ¯è¾“å…¥**ï¼šè¾“å…¥å¹´é¾„ã€æ€§åˆ«ã€èº«é«˜ã€ä½“é‡
3. **éš¾åº¦é€‰æ‹©**ï¼šç³»ç»Ÿè‡ªåŠ¨æ¨èæˆ–æ‰‹åŠ¨é€‰æ‹©éš¾åº¦
4. **å¼€å§‹æ¸¸æˆ**ï¼š3 ç§’å€’è®¡æ—¶åå¼€å§‹è®­ç»ƒ
5. **å®æ—¶åé¦ˆ**ï¼šæŸ¥çœ‹åŠ¨ä½œåˆ†æå’Œå®æ—¶è¯„åˆ†
6. **ç»“æœå±•ç¤º**ï¼šæ¸¸æˆç»“æŸåæŸ¥çœ‹æœ€ç»ˆåˆ†æ•°å’Œè¥å…»å»ºè®®

## ğŸ›  æŠ€æœ¯æ ˆ

- **å‰ç«¯**ï¼šHTML5, CSS3, JavaScript
- **AI æŠ€æœ¯**ï¼šGoogle MediaPipe
- **è§†é¢‘å¤„ç†**ï¼šHTML5 Video API
- **å›¾åƒå¤„ç†**ï¼šCanvas API
- **æ‘„åƒå¤´è®¿é—®**ï¼šWebRTC getUserMedia API

## ğŸ“ æ–‡ä»¶ç»“æ„

```
elderly_game_toy_page/
â”œâ”€â”€ index.html              # ä¸»æ¸¸æˆæ–‡ä»¶
â”œâ”€â”€ easy.mp4               # ç®€å•éš¾åº¦æ ‡å‡†åŠ¨ä½œè§†é¢‘
â”œâ”€â”€ medium.mp4             # ä¸­ç­‰éš¾åº¦æ ‡å‡†åŠ¨ä½œè§†é¢‘
â”œâ”€â”€ hard.mp4               # å›°éš¾éš¾åº¦æ ‡å‡†åŠ¨ä½œè§†é¢‘
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ video-setup-guide.md   # è§†é¢‘è®¾ç½®æŒ‡å—
â”œâ”€â”€ deployment-guide.md    # éƒ¨ç½²æŒ‡å—
â””â”€â”€ todo.md               # é¡¹ç›®éœ€æ±‚æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/yourusername/elderly_game_toy_page.git
cd elderly_game_toy_page
```

### 2. å‡†å¤‡è§†é¢‘æ–‡ä»¶
æ ¹æ® `video-setup-guide.md` çš„è¯´æ˜å‡†å¤‡ä¸‰ä¸ªéš¾åº¦çš„æ ‡å‡†åŠ¨ä½œè§†é¢‘ï¼š
- `easy.mp4` - ç®€å•éš¾åº¦
- `medium.mp4` - ä¸­ç­‰éš¾åº¦  
- `hard.mp4` - å›°éš¾éš¾åº¦

### 3. æœ¬åœ°æµ‹è¯•
ç”±äºéœ€è¦æ‘„åƒå¤´æƒé™ï¼Œå»ºè®®ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨ï¼š
```bash
# ä½¿ç”¨ Python
python -m http.server 8000

# æˆ–ä½¿ç”¨ Node.js
npx http-server
```

### 4. éƒ¨ç½²åˆ° GitHub Pages
å‚è€ƒ `deployment-guide.md` è¿›è¡Œéƒ¨ç½²ã€‚

## ğŸ¯ BMI éš¾åº¦æ¨èç®—æ³•

```javascript
const bmi = weight / ((height / 100) ** 2);
let defaultDifficulty = 'medium';

if (age > 70 || bmi > 30) {
    defaultDifficulty = 'easy';    // é«˜é¾„æˆ–è‚¥èƒ–ç”¨æˆ·
} else if (bmi < 18.5 || (bmi >= 18.5 && bmi <= 24.9)) {
    defaultDifficulty = 'hard';    // åç˜¦æˆ–æ­£å¸¸ä½“é‡ç”¨æˆ·
}
```

## ğŸ“Š è¯„åˆ†ç³»ç»Ÿ

### è®¡ç®—æ–¹æ³•
1. **å§¿æ€æå–**ï¼šä½¿ç”¨ MediaPipe æå– 33 ä¸ªå…³é”®ç‚¹
2. **å…³é”®ç‚¹é€‰æ‹©**ï¼šé€‰æ‹© 12 ä¸ªä¸»è¦å…³é”®ç‚¹è¿›è¡Œæ¯”è¾ƒ
3. **è·ç¦»è®¡ç®—**ï¼šè®¡ç®—ç”¨æˆ·å§¿æ€ä¸æ ‡å‡†å§¿æ€çš„æ¬§å‡ é‡Œå¾—è·ç¦»
4. **ç›¸ä¼¼åº¦è½¬æ¢**ï¼š`similarity = max(0, 100 - distance * 100)`
5. **å¹³å‡å¾—åˆ†**ï¼šæ‰€æœ‰å¸§çš„å¹³å‡ç›¸ä¼¼åº¦ä½œä¸ºæœ€ç»ˆå¾—åˆ†

### è¥å…»å»ºè®®åˆ†çº§
- **80-100 åˆ†**ï¼šåŠ¨ä½œæ ‡å‡†ç¨‹åº¦é«˜ - ç»´æŒæ€§è¥å…»å»ºè®®
- **60-79 åˆ†**ï¼šåŠ¨ä½œæ ‡å‡†ç¨‹åº¦ä¸­ç­‰ - å¼ºåŒ–æ€§è¥å…»å»ºè®®  
- **0-59 åˆ†**ï¼šåŠ¨ä½œæ ‡å‡†ç¨‹åº¦ä½ - è¡¥å……æ€§è¥å…»å»ºè®®

## ğŸŒ æµè§ˆå™¨æ”¯æŒ

| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ | å¤‡æ³¨ |
|--------|----------|------|
| Chrome | 60+ | æ¨èä½¿ç”¨ |
| Firefox | 55+ | å®Œå…¨æ”¯æŒ |
| Safari | 11+ | iOS éœ€è¦ 12+ |
| Edge | 79+ | åŸºäº Chromium |

## ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ

- âœ… å“åº”å¼è®¾è®¡
- âœ… è§¦æ‘¸å‹å¥½ç•Œé¢
- âœ… ç§»åŠ¨ç«¯æ‘„åƒå¤´æ”¯æŒ
- âœ… ç«–å±/æ¨ªå±é€‚é…

## ğŸ”’ éšç§ä¿æŠ¤

- ğŸš« ä¸æ”¶é›†ä¸ªäººæ•°æ®
- ğŸš« ä¸ä¸Šä¼ è§†é¢‘å†…å®¹
- ğŸš« ä¸ä¿å­˜ç”¨æˆ·ä¿¡æ¯
- âœ… æ‰€æœ‰å¤„ç†æœ¬åœ°å®Œæˆ
- âœ… ç¬¦åˆ GDPR è¦æ±‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/new-feature`
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Google MediaPipe](https://mediapipe.dev/) - æä¾›å¼ºå¤§çš„å§¿æ€æ£€æµ‹æŠ€æœ¯
- [GitHub Pages](https://pages.github.com/) - å…è´¹çš„é™æ€ç½‘ç«™æ‰˜ç®¡æœåŠ¡

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ [GitHub Issue](https://github.com/yourusername/elderly_game_toy_page/issues)
- å‘é€é‚®ä»¶è‡³ï¼šyour.email@example.com

---

**âš ï¸ é‡è¦æé†’**ï¼šæœ¬ç½‘ç«™æä¾›çš„å†…å®¹ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä¸“ä¸šåŒ»ç–—å»ºè®®ã€‚ä½¿ç”¨å‰è¯·å’¨è¯¢åŒ»ç”Ÿï¼Œè¿åŠ¨æ—¶æ³¨æ„å®‰å…¨ã€‚

        .difficulty-selector label {
            font-weight: bold;
            font-size: 20px;
            color: var(--primary-color);
            margin-right: 15px;
        }

        .difficulty-selector select {
            padding: 12px 20px;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
        }

        /* è§†é¢‘åŒºåŸŸ */
        .video-container {
            position: relative;
            background-color: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 25px;
            min-height: 400px;
        }

        .standard-video {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 25%;
            height: 25%;
            border: 3px solid var(--secondary-color);
            border-radius: 10px;
            z-index: 10;
        }

        .user-video {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }

        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 20;
        }

        /* åˆ†æ•°æ˜¾ç¤º */
        .score-display {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .score-display h3 {
            color: var(--primary-color);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .score-value {
            font-size: 48px;
            font-weight: bold;
            color: var(--success-color);
        }

        /* æ¸¸æˆæ§åˆ¶æŒ‰é’® */
        .game-control-btn {
            width: 100%;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-control-btn:hover {
            background-color: #38a169;
            transform: translateY(-2px);
        }

        .game-control-btn:disabled {
            background-color: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .container {
                padding: 10px;
            }
            
            .modal-content {
                margin: 5% auto;
                padding: 20px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 16px;
            }
            
            .score-value {
                font-size: 36px;
            }
            
            .countdown {
                font-size: 80px;
            }
        }

        /* éšè—ç±» */
        .hidden {
            display: none !important;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- è¯­è¨€é€‰æ‹©å™¨ -->
    <div class="language-selector">
        <select id="languageSelect" onchange="changeLanguage()">
            <option value="zh">ä¸­æ–‡</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- å…è´£å£°æ˜æ¨¡æ€æ¡† -->
    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <h2 data-translate="disclaimer_title">å…è´£å£°æ˜</h2>
            <p data-translate="disclaimer_text">
                æœ¬ç½‘ç«™çš„å†…å®¹ä¸æ„æˆä¸“ä¸šçš„åŒ»ç–—å»ºè®®ï¼Œè¯·æ ¹æ®è‡ªå·±çš„èº«ä½“çŠ¶å†µé€‰æ‹©é€‚å½“çš„æ´»åŠ¨ï¼Œæœ¬ç½‘ç«™æå‡ºçš„å»ºè®®ä»…ä½œä¸ºå‚è€ƒå¹¶ä¸”ä¸æ„æˆä»»ä½•åŒ»ç–—å»ºè®®ï¼Œå¦‚æœæ„Ÿåˆ°èº«ä½“ä¸é€‚ï¼Œè¯·åŠæ—¶å°±åŒ»ã€‚æœ¬ç½‘ç«™ä¸ä¼šæ”¶é›†æ‚¨çš„ä¸ªäººæ•°æ®ä¹Ÿä¸ä¼šä¿å­˜ä»»ä½•è§†é¢‘ï¼Œæ‚¨åœ¨æœ¬ç½‘ç«™ä¸­è¾“å…¥çš„ä»»ä½•ä¿¡æ¯éƒ½åªæ˜¯ä¸ºäº†æ¨èæ›´åŠ é€‚åˆæ‚¨çš„å°æ¸¸æˆè€Œä½¿ç”¨ï¼Œå®ƒä»¬ä¸ä¼šè¢«ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚
            </p>
            <button class="btn btn-primary" onclick="acceptDisclaimer()" data-translate="accept">æˆ‘åŒæ„</button>
            <button class="btn btn-secondary" onclick="declineDisclaimer()" data-translate="decline">ä¸åŒæ„</button>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯è¾“å…¥æ¨¡æ€æ¡† -->
    <div id="userInfoModal" class="modal">
        <div class="modal-content">
            <h2 data-translate="user_info_title">è¯·è¾“å…¥æ‚¨çš„åŸºæœ¬ä¿¡æ¯</h2>
            <form id="userInfoForm">
                <div class="form-group">
                    <label for="age" data-translate="age_label">å¹´é¾„ï¼š</label>
                    <input type="number" id="age" name="age" min="1" max="120" required>
                </div>
                <div class="form-group">
                    <label for="gender" data-translate="gender_label">æ€§åˆ«ï¼š</label>
                    <select id="gender" name="gender" required>
                        <option value="" data-translate="select_gender">è¯·é€‰æ‹©</option>
                        <option value="male" data-translate="male">ç”·</option>
                        <option value="female" data-translate="female">å¥³</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="height" data-translate="height_label">èº«é«˜ï¼ˆå˜ç±³ï¼‰ï¼š</label>
                    <input type="number" id="height" name="height" min="100" max="250" required>
                </div>
                <div class="form-group">
                    <label for="weight" data-translate="weight_label">ä½“é‡ï¼ˆå…¬æ–¤ï¼‰ï¼š</label>
                    <input type="number" id="weight" name="weight" min="30" max="200" required>
                </div>
                <button type="submit" class="btn btn-primary" data-translate="start_game">å¼€å§‹æ¸¸æˆ</button>
            </form>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æœæ¨¡æ€æ¡† -->
    <div id="gameResultModal" class="modal">
        <div class="modal-content">
            <h2 data-translate="game_result_title">æ¸¸æˆç»“æœ</h2>
            <div class="score-display">
                <h3 data-translate="final_score">æœ€ç»ˆå¾—åˆ†</h3>
                <div class="score-value" id="finalScore">0</div>
            </div>
            <div id="nutritionAdvice">
                <h3 data-translate="nutrition_advice_title">è¥å…»å»ºè®®</h3>
                <p id="nutritionAdviceText"></p>
            </div>
            <button class="btn btn-primary" onclick="restartGame()" data-translate="play_again">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <!-- ä¸»æ¸¸æˆç•Œé¢ -->
    <div class="container">
        <div class="game-interface" id="gameInterface">
            <h1 data-translate="game_title">ä¸­è€å¹´å¹³è¡¡æ„Ÿè®­ç»ƒæ¸¸æˆ</h1>
            
            <!-- æ¸¸æˆæ§åˆ¶åŒºåŸŸ -->
            <div class="game-controls">
                <div class="difficulty-selector">
                    <label for="difficultySelect" data-translate="difficulty_label">æ¸¸æˆéš¾åº¦ï¼š</label>
                    <select id="difficultySelect" onchange="changeDifficulty()">
                        <option value="easy" data-translate="easy">ç®€å•</option>
                        <option value="medium" data-translate="medium">ä¸­ç­‰</option>
                        <option value="hard" data-translate="hard">å›°éš¾</option>
                    </select>
                </div>
                
                <!-- åˆ†æ•°æ˜¾ç¤º -->
                <div class="score-display">
                    <h3 data-translate="current_score">å½“å‰å¹³å‡å¾—åˆ†</h3>
                    <div class="score-value" id="currentScore">0</div>
                </div>
            </div>

            <!-- è§†é¢‘æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="video-container" id="videoContainer">
                <video id="standardVideo" class="standard-video" muted loop style="display: none;">
                    <source src="easy.mp4" type="video/mp4">
                </video>
                <video id="userVideo" class="user-video" autoplay muted playsinline></video>
                <canvas id="userCanvas" class="user-video" style="display: none;"></canvas>
                <div id="countdown" class="countdown" style="display: none;"></div>
            </div>

            <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® -->
            <button id="gameControlBtn" class="game-control-btn" onclick="toggleGame()" data-translate="start_game">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- MediaPipe å’Œå…¶ä»–è„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

    <script>
        // å¤šè¯­è¨€æ”¯æŒ
        const translations = {
            zh: {
                disclaimer_title: "å…è´£å£°æ˜",
                disclaimer_text: "æœ¬ç½‘ç«™çš„å†…å®¹ä¸æ„æˆä¸“ä¸šçš„åŒ»ç–—å»ºè®®ï¼Œè¯·æ ¹æ®è‡ªå·±çš„èº«ä½“çŠ¶å†µé€‰æ‹©é€‚å½“çš„æ´»åŠ¨ï¼Œæœ¬ç½‘ç«™æå‡ºçš„å»ºè®®ä»…ä½œä¸ºå‚è€ƒå¹¶ä¸”ä¸æ„æˆä»»ä½•åŒ»ç–—å»ºè®®ï¼Œå¦‚æœæ„Ÿåˆ°èº«ä½“ä¸é€‚ï¼Œè¯·åŠæ—¶å°±åŒ»ã€‚æœ¬ç½‘ç«™ä¸ä¼šæ”¶é›†æ‚¨çš„ä¸ªäººæ•°æ®ä¹Ÿä¸ä¼šä¿å­˜ä»»ä½•è§†é¢‘ï¼Œæ‚¨åœ¨æœ¬ç½‘ç«™ä¸­è¾“å…¥çš„ä»»ä½•ä¿¡æ¯éƒ½åªæ˜¯ä¸ºäº†æ¨èæ›´åŠ é€‚åˆæ‚¨çš„å°æ¸¸æˆè€Œä½¿ç”¨ï¼Œå®ƒä»¬ä¸ä¼šè¢«ä¸Šä¼ åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚",
                accept: "æˆ‘åŒæ„",
                decline: "ä¸åŒæ„",
                user_info_title: "è¯·è¾“å…¥æ‚¨çš„åŸºæœ¬ä¿¡æ¯",
                age_label: "å¹´é¾„ï¼š",
                gender_label: "æ€§åˆ«ï¼š",
                select_gender: "è¯·é€‰æ‹©",
                male: "ç”·",
                female: "å¥³",
                height_label: "èº«é«˜ï¼ˆå˜ç±³ï¼‰ï¼š",
                weight_label: "ä½“é‡ï¼ˆå…¬æ–¤ï¼‰ï¼š",
                start_game: "å¼€å§‹æ¸¸æˆ",
                game_title: "ä¸­è€å¹´å¹³è¡¡æ„Ÿè®­ç»ƒæ¸¸æˆ",
                difficulty_label: "æ¸¸æˆéš¾åº¦ï¼š",
                easy: "ç®€å•",
                medium: "ä¸­ç­‰",
                hard: "å›°éš¾",
                current_score: "å½“å‰å¹³å‡å¾—åˆ†",
                game_result_title: "æ¸¸æˆç»“æœ",
                final_score: "æœ€ç»ˆå¾—åˆ†",
                nutrition_advice_title: "è¥å…»å»ºè®®",
                play_again: "å†ç©ä¸€æ¬¡",
                stop_game: "ç»“æŸæ¸¸æˆ"
            },
            en: {
                disclaimer_title: "Disclaimer",
                disclaimer_text: "The content of this website does not constitute professional medical advice. Please choose appropriate activities based on your physical condition. The suggestions provided by this website are for reference only and do not constitute any medical advice. If you feel unwell, please seek medical attention promptly. This website will not collect your personal data or save any videos. Any information you enter on this website is only used to recommend games more suitable for you and will not be uploaded to our servers.",
                accept: "I Agree",
                decline: "Decline",
                user_info_title: "Please Enter Your Basic Information",
                age_label: "Age:",
                gender_label: "Gender:",
                select_gender: "Please Select",
                male: "Male",
                female: "Female",
                height_label: "Height (cm):",
                weight_label: "Weight (kg):",
                start_game: "Start Game",
                game_title: "Balance Training Game for Seniors",
                difficulty_label: "Game Difficulty:",
                easy: "Easy",
                medium: "Medium",
                hard: "Hard",
                current_score: "Current Average Score",
                game_result_title: "Game Result",
                final_score: "Final Score",
                nutrition_advice_title: "Nutrition Advice",
                play_again: "Play Again",
                stop_game: "Stop Game"
            }
        };

        // å…¨å±€å˜é‡
        let currentLanguage = 'zh';
        let userInfo = {};
        let gameState = 'stopped'; // 'stopped', 'countdown', 'playing'
        let pose = null;
        let camera = null;
        let standardPoseData = [];
        let userPoseData = [];
        let gameStartTime = null;
        let totalScore = 0;
        let frameCount = 0;
        let gameInterval = null;

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºå…è´£å£°æ˜
        window.addEventListener('load', function() {
            document.getElementById('disclaimerModal').style.display = 'block';
        });

        // è¯­è¨€åˆ‡æ¢åŠŸèƒ½
        function changeLanguage() {
            const select = document.getElementById('languageSelect');
            currentLanguage = select.value;
            updateLanguage();
        }

        function updateLanguage() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
        }

        // å…è´£å£°æ˜å¤„ç†
        function acceptDisclaimer() {
            document.getElementById('disclaimerModal').style.display = 'none';
            document.getElementById('userInfoModal').style.display = 'block';
        }

        function declineDisclaimer() {
            alert(currentLanguage === 'zh' ? 'æ„Ÿè°¢æ‚¨çš„è®¿é—®ï¼' : 'Thank you for visiting!');
            window.close();
        }

        // ç”¨æˆ·ä¿¡æ¯è¡¨å•å¤„ç†
        document.getElementById('userInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            userInfo = {
                age: parseInt(formData.get('age')),
                gender: formData.get('gender'),
                height: parseInt(formData.get('height')),
                weight: parseInt(formData.get('weight'))
            };

            // è®¡ç®— BMI å¹¶è®¾ç½®é»˜è®¤éš¾åº¦
            const bmi = userInfo.weight / ((userInfo.height / 100) ** 2);
            let defaultDifficulty = 'medium';
            
            if (userInfo.age > 70 || bmi > 30) {
                defaultDifficulty = 'easy';
            } else if (bmi < 18.5 || (bmi >= 18.5 && bmi <= 24.9)) {
                defaultDifficulty = 'hard';
            }

            document.getElementById('difficultySelect').value = defaultDifficulty;
            document.getElementById('userInfoModal').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initializeGame();
        });

        // æ¸¸æˆåˆå§‹åŒ–
        async function initializeGame() {
            try {
                // åˆå§‹åŒ–MediaPipe Pose
                pose = new Pose({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                    }
                });

                pose.setOptions({
                    modelComplexity: 1,
                    smoothLandmarks: true,
                    enableSegmentation: false,
                    smoothSegmentation: false,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });

                pose.onResults(onPoseResults);

                // åˆå§‹åŒ–æ‘„åƒå¤´
                const videoElement = document.getElementById('userVideo');
                camera = new Camera(videoElement, {
                    onFrame: async () => {
                        if (gameState === 'playing') {
                            await pose.send({image: videoElement});
                        }
                    },
                    width: 640,
                    height: 480
                });

                await camera.start();
                
                // è®¾ç½®æ ‡å‡†è§†é¢‘
                changeDifficulty();
                
            } catch (error) {
                console.error('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼š', error);
                alert(currentLanguage === 'zh' ? 'æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‘„åƒå¤´æƒé™' : 'Game initialization failed, please check camera permissions');
            }
        }

        // éš¾åº¦åˆ‡æ¢
        function changeDifficulty() {
            const difficulty = document.getElementById('difficultySelect').value;
            const standardVideo = document.getElementById('standardVideo');
            standardVideo.src = `${difficulty}.mp4`;
        }

        // å§¿æ€æ£€æµ‹ç»“æœå¤„ç†
        function onPoseResults(results) {
            if (!results.poseLandmarks || gameState !== 'playing') return;

            const canvas = document.getElementById('userCanvas');
            const canvasCtx = canvas.getContext('2d');
            const videoElement = document.getElementById('userVideo');
            
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            canvas.style.display = 'block';
            videoElement.style.display = 'none';

            // æ¸…é™¤ç”»å¸ƒ
            canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶è§†é¢‘å¸§
            canvasCtx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å§¿æ€ç‚¹å’Œè¿çº¿
            drawPose(canvasCtx, results.poseLandmarks);
            
            // ä¿å­˜ç”¨æˆ·å§¿æ€æ•°æ®
            userPoseData.push(results.poseLandmarks);
            
            // è®¡ç®—å¾—åˆ†
            calculateScore();
        }

        // ç»˜åˆ¶å§¿æ€
        function drawPose(ctx, landmarks) {
            // ç»˜åˆ¶å…³é”®ç‚¹
            landmarks.forEach(landmark => {
                ctx.beginPath();
                ctx.arc(landmark.x * ctx.canvas.width, landmark.y * ctx.canvas.height, 5, 0, 2 * Math.PI);
                ctx.fillStyle = '#00ff00';
                ctx.fill();
            });

            // ç»˜åˆ¶è¿çº¿ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const connections = [
                [11, 12], [11, 13], [12, 14], [13, 15], [14, 16], // ä¸Šèº«
                [11, 23], [12, 24], [23, 24], // èº¯å¹²
                [23, 25], [24, 26], [25, 27], [26, 28] // ä¸‹èº«
            ];

            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 2;
            
            connections.forEach(([start, end]) => {
                if (landmarks[start] && landmarks[end]) {
                    ctx.beginPath();
                    ctx.moveTo(landmarks[start].x * ctx.canvas.width, landmarks[start].y * ctx.canvas.height);
                    ctx.lineTo(landmarks[end].x * ctx.canvas.width, landmarks[end].y * ctx.canvas.height);
                    ctx.stroke();
                }
            });
        }

        // è®¡ç®—å¾—åˆ†
        function calculateScore() {
            if (standardPoseData.length === 0 || userPoseData.length === 0) return;

            // è·å–æœ€æ–°çš„æ ‡å‡†å§¿æ€å’Œç”¨æˆ·å§¿æ€
            const standardPose = standardPoseData[standardPoseData.length - 1];
            const userPose = userPoseData[userPoseData.length - 1];

            if (!standardPose || !userPose) return;

            // è®¡ç®—å…³é”®ç‚¹çš„ç›¸ä¼¼åº¦
            let similarity = 0;
            let validPoints = 0;

            // é€‰æ‹©ä¸»è¦å…³é”®ç‚¹è¿›è¡Œæ¯”è¾ƒ
            const keyPoints = [11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28];
            
            keyPoints.forEach(pointIndex => {
                if (standardPose[pointIndex] && userPose[pointIndex]) {
                    const standardPoint = standardPose[pointIndex];
                    const userPoint = userPose[pointIndex];
                    
                    // è®¡ç®—æ¬§å‡ é‡Œå¾—è·ç¦»
                    const distance = Math.sqrt(
                        Math.pow(standardPoint.x - userPoint.x, 2) +
                        Math.pow(standardPoint.y - userPoint.y, 2) +
                        Math.pow(standardPoint.z - userPoint.z, 2)
                    );
                    
                    // è½¬æ¢ä¸ºç›¸ä¼¼åº¦åˆ†æ•°ï¼ˆè·ç¦»è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šé«˜ï¼‰
                    const pointSimilarity = Math.max(0, 100 - distance * 100);
                    similarity += pointSimilarity;
                    validPoints++;
                }
            });

            if (validPoints > 0) {
                const frameScore = similarity / validPoints;
                totalScore += frameScore;
                frameCount++;
                
                // æ›´æ–°æ˜¾ç¤ºçš„å¹³å‡å¾—åˆ†
                const averageScore = Math.round(totalScore / frameCount);
                document.getElementById('currentScore').textContent = averageScore;
            }
        }

        // æ¸¸æˆæ§åˆ¶
        function toggleGame() {
            if (gameState === 'stopped') {
                startGame();
            } else {
                stopGame();
            }
        }

        function startGame() {
            gameState = 'countdown';
            const btn = document.getElementById('gameControlBtn');
            btn.disabled = true;
            btn.textContent = currentLanguage === 'zh' ? 'å‡†å¤‡ä¸­...' : 'Preparing...';
            
            // é‡ç½®æ¸¸æˆæ•°æ®
            standardPoseData = [];
            userPoseData = [];
            totalScore = 0;
            frameCount = 0;
            document.getElementById('currentScore').textContent = '0';
            
            // å¼€å§‹å€’è®¡æ—¶
            startCountdown();
        }

        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            countdownElement.style.display = 'block';
            let count = 3;
            
            const countdownInterval = setInterval(() => {
                countdownElement.textContent = count;
                count--;
                
                if (count < 0) {
                    clearInterval(countdownInterval);
                    countdownElement.style.display = 'none';
                    startActualGame();
                }
            }, 1000);
        }

        function startActualGame() {
            gameState = 'playing';
            gameStartTime = Date.now();
            
            const btn = document.getElementById('gameControlBtn');
            btn.disabled = false;
            btn.textContent = currentLanguage === 'zh' ? 'ç»“æŸæ¸¸æˆ' : 'Stop Game';
            
            // å¼€å§‹æ’­æ”¾æ ‡å‡†è§†é¢‘
            const standardVideo = document.getElementById('standardVideo');
            standardVideo.style.display = 'block';
            standardVideo.currentTime = 0;
            standardVideo.play();
            
            // ç›‘å¬æ ‡å‡†è§†é¢‘ç»“æŸ
            standardVideo.onended = () => {
                stopGame();
            };
            
            // å¼€å§‹åˆ†ææ ‡å‡†è§†é¢‘ï¼ˆç®€åŒ–ç‰ˆ - å®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„å®ç°ï¼‰
            simulateStandardPoseData();
        }

        function simulateStandardPoseData() {
            // è¿™é‡Œåº”è¯¥åˆ†ææ ‡å‡†è§†é¢‘çš„æ¯ä¸€å¸§
            // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€äº›æ¨¡æ‹Ÿæ•°æ®
            gameInterval = setInterval(() => {
                if (gameState === 'playing') {
                    // ç”Ÿæˆæ¨¡æ‹Ÿçš„æ ‡å‡†å§¿æ€æ•°æ®
                    const mockStandardPose = generateMockPoseData();
                    standardPoseData.push(mockStandardPose);
                }
            }, 100); // æ¯ 100ms ç”Ÿæˆä¸€æ¬¡æ•°æ®
        }

        function generateMockPoseData() {
            // ç”Ÿæˆ 33 ä¸ªå…³é”®ç‚¹çš„æ¨¡æ‹Ÿæ•°æ®
            const pose = [];
            for (let i = 0; i < 33; i++) {
                pose.push({
                    x: Math.random() * 0.6 + 0.2, // 0.2 åˆ° 0.8 ä¹‹é—´
                    y: Math.random() * 0.6 + 0.2,
                    z: Math.random() * 0.2 - 0.1,
                    visibility: Math.random() * 0.5 + 0.5
                });
            }
            return pose;
        }

        function stopGame() {
            gameState = 'stopped';
            
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            const btn = document.getElementById('gameControlBtn');
            btn.disabled = false;
            btn.textContent = currentLanguage === 'zh' ? 'å¼€å§‹æ¸¸æˆ' : 'Start Game';
            
            // åœæ­¢æ ‡å‡†è§†é¢‘
            const standardVideo = document.getElementById('standardVideo');
            standardVideo.style.display = 'none';
            standardVideo.pause();
            
            // æ˜¾ç¤ºç”¨æˆ·è§†é¢‘
            document.getElementById('userVideo').style.display = 'block';
            document.getElementById('userCanvas').style.display = 'none';
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æœ
            showGameResult();
        }

        function showGameResult() {
            const finalScore = frameCount > 0 ? Math.round(totalScore / frameCount) : 0;
            document.getElementById('finalScore').textContent = finalScore;
            
            // ç”Ÿæˆè¥å…»å»ºè®®
            const nutritionAdvice = generateNutritionAdvice(finalScore);
            document.getElementById('nutritionAdviceText').textContent = nutritionAdvice;
            
            document.getElementById('gameResultModal').style.display = 'block';
        }

        function generateNutritionAdvice(score) {
            const adviceZh = {
                high: "æ‚¨çš„åŠ¨ä½œæ ‡å‡†ç¨‹åº¦å¾ˆé«˜ï¼å»ºè®®ç»§ç»­ä¿æŒå‡è¡¡é¥®é£Ÿï¼Œå¤šæ‘„å…¥å¯Œå«è›‹ç™½è´¨çš„é£Ÿç‰©å¦‚é±¼ç±»ã€è±†ç±»ï¼Œä»¥åŠæ–°é²œè”¬èœæ°´æœã€‚é€‚é‡è¡¥å……ç»´ç”Ÿç´  D å’Œé’™è´¨ï¼Œæœ‰åŠ©äºéª¨éª¼å¥åº·ã€‚",
                medium: "æ‚¨çš„åŠ¨ä½œæ ‡å‡†ç¨‹åº¦ä¸­ç­‰ï¼Œå»ºè®®åŠ å¼ºè¥å…»æ‘„å…¥ã€‚å¤šåƒå¯Œå« omega-3 è„‚è‚ªé…¸çš„é£Ÿç‰©å¦‚æ·±æµ·é±¼ã€åšæœï¼Œå¢åŠ è›‹ç™½è´¨æ‘„å…¥ï¼Œé€‚é‡è¡¥å……ç»´ç”Ÿç´  B ç¾¤å’Œé•å…ƒç´ ï¼Œæœ‰åŠ©äºè‚Œè‚‰åŠŸèƒ½ã€‚",
                low: "å»ºè®®åŠ å¼ºè¥å…»è¡¥å……ï¼Œå¤šæ‘„å…¥ä¼˜è´¨è›‹ç™½è´¨å¦‚ç˜¦è‚‰ã€é¸¡è›‹ã€å¥¶åˆ¶å“ï¼Œå¢åŠ ç»´ç”Ÿç´  C å’Œ E çš„æ‘„å…¥ï¼Œå¤šåƒæŠ—æ°§åŒ–é£Ÿç‰©å¦‚è“è“ã€ç»¿èŒ¶ã€‚å»ºè®®å’¨è¯¢è¥å…»å¸ˆåˆ¶å®šä¸ªæ€§åŒ–é¥®é£Ÿè®¡åˆ’ã€‚"
            };
            
            const adviceEn = {
                high: "Your movement accuracy is excellent! Continue maintaining a balanced diet with protein-rich foods like fish and legumes, plus fresh vegetables and fruits. Adequate vitamin D and calcium supplementation helps bone health.",
                medium: "Your movement accuracy is moderate. Strengthen nutrition intake with omega-3 rich foods like deep-sea fish and nuts, increase protein intake, and supplement with vitamin B complex and magnesium for muscle function.",
                low: "Recommend strengthening nutritional supplementation with high-quality proteins like lean meat, eggs, and dairy products. Increase vitamin C and E intake with antioxidant foods like blueberries and green tea. Consider consulting a nutritionist for a personalized diet plan."
            };
            
            const advice = currentLanguage === 'zh' ? adviceZh : adviceEn;
            
            if (score >= 80) return advice.high;
            if (score >= 60) return advice.medium;
            return advice.low;
        }

        function restartGame() {
            document.getElementById('gameResultModal').style.display = 'none';
            document.getElementById('userInfoModal').style.display = 'block';
        }

        // åˆå§‹åŒ–è¯­è¨€
        updateLanguage();
    </script>
</body>
</html> 